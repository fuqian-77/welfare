$(window).resize(function(){pmyGrid1=myTextGrid(pmyGrid1);pmyGrid1=myLoadTextGridData(pmyGrid1);pmyGrid1=myCellFocus(pmyGrid1,0,0);});function myTextGrid(c){if($("#"+c.id+"_toplayout").length>0){$("#"+c.id+"_toplayout").remove();}if(c.headerheight==undefined){c.headerheight=c.rowheight;}if(c.clickonselect==undefined){c.clickonselect=false;}if(c.rownumberwidth==undefined){c.rownumberwidth=40;}if(c.checkboxwidth==undefined){c.checkboxwidth=30;}c=myTextGridColumns(c);if(c.height==0){c.height=$("#"+c.parent).height()-60;}if(c.width==0){c.width=$("#"+c.parent).width()-300;}if(c.width==0){}c.deletedrows="";c.left=0;c.fixedwidth=0;c.fixedfieldcol=-1;c.keyfieldfieldcol=-1;for(var a=0;a<c.columns.length;a++){if(c.columns[a].name==c.keyfield||c.columns[a].name==c.fixedfield){c.fixedwidth=c.columns[a].length;c.fixedfieldcol=a;if(c.columns[a].name==c.keyfield){c.keyfieldcol=a;}break;}}e="<div id='"+c.id+"_toplayout' class='easyui-layout' data-options='fit:true' style='overflow:hidden;'></div>";$("#"+c.parent).append($(e));$("#"+c.id+"_toplayout").layout();$("#"+c.id+"_toplayout").layout("add",{id:c.id+"_bbar",region:"south",split:false,border:0,collapsible:false,height:35});$("#"+c.id+"_toplayout").layout("add",{id:c.id+"_center",region:"center",split:false,border:1,title:c.title,collapsible:false});$("#"+c.id+"_center").panel();e="<div id='"+c.id+"_layout' class='easyui-layout' data-options='fit:true' style='overflow:hidden;'></div>";$("#"+c.id+"_center").append($(e));$("#"+c.id+"_layout").layout();$("#"+c.id+"_layout").layout("add",{id:c.id+"_leftpanel",region:"west",split:false,border:0,collapsible:false,width:1*c.rownumberwidth+1*c.checkboxwidth+1*c.fixedwidth+2+2});$("#"+c.id+"_layout").layout("add",{id:c.id+"_toppanel",region:"north",split:false,border:0,collapsible:false,height:1*c.headerheight+1+3});$("#"+c.id+"_layout").layout("add",{id:c.id+"_mainpanel",region:"center",split:false,border:0,collapsible:false});e="<div id='"+c.id+"_headlayout' class='easyui-layout' data-options='fit:true' style='overflow:hidden;margin:0px 0px 0px 0px;'></div>";$("#"+c.id+"_toppanel").append($(e));$("#"+c.id+"_headlayout").layout();$("#"+c.id+"_headlayout").layout("add",{id:c.id+"_headpanel1",region:"west",split:false,border:0,collapsible:false,width:1*c.left+1*c.rownumberwidth+1*c.checkboxwidth+1*c.fixedwidth+2+2});$("#"+c.id+"_headlayout").layout("add",{id:c.id+"_headpanel2",region:"center",split:false,border:0,collapsible:false});$("#"+c.id+"_headpanel1").panel({height:1*c.headerheight});$("#"+c.id+"_headpanel2").panel({height:1*c.headerheight});$("#"+c.id+"_leftpanel").panel();$("#"+c.id+"_bbar").panel();$("#"+c.id+"_bbar").css({overflow:"hidden","background-color":"#E0ECFF","border-width":"0px"});$("#"+c.id+"_mainpanel").panel();myForm(c.id,c.id+"_mainpanel","",0,0,0,0,"");myForm(c.id+"_fixedpanel",c.id+"_leftpanel","",0,0,0,0,"");myForm(c.id+"_hbar1",c.id+"_headpanel1","",0,0,0,0,"");myForm(c.id+"_hbar2",c.id+"_headpanel2","",0,0,0,0,"");$("#"+c.id).css({overflow:"auto","border-width":"0px","margin":"0px 0px 0px 0px"});$("#"+c.id+"_fixedpanel").css({"overflow-y":"hidden","border-width":"0px","margin":"0px 0px 0px 2px"});$("#"+c.id+"_hbar1").panel({height:1*c.headerheight+4});$("#"+c.id+"_hbar1").css({left:c.left+"px",overflow:"hidden","background-color":"#E0ECFF",margin:"2px 0px 0px 2px","border-width":"0px"});$("#"+c.id+"_hbar2").panel({height:1*c.headerheight+4});$("#"+c.id+"_hbar2").css({overflow:"hidden",margin:"2px 0px 0px 0px","border-width":"0px"});$("#"+c.id+"_headpanel1").css({overflow:"hidden"});$("#"+c.id+"_headpanel2").css({overflow:"hidden"});$("#"+c.id+"_headlayout").css({overflow:"hidden"});$("#"+c.id+"_leftpanel").css({overflow:"hidden"});$("#"+c.id+"_mainpanel").css({overflow:"hidden"});$("#"+c.id+"_layout").css({overflow:"hidden"});$("#"+c.id+"_toplayout").css({overflow:"hidden"});$("#"+c.parent).css({overflow:"hidden"});scrollsize=myGetBrowserScrollSize();c=myCreateGridHeader(c);c.rowindex=0;c.colindex=0;var e="";var b="";var d="";myCreateGridRows(c,0,c.rows);c.rowcount=c.rows;if(c.menu!=undefined&&c.menu!=""){$("#"+c.parent).bind("contextmenu",function(f){f.preventDefault();$("#"+c.menu).menu("show",{left:f.pageX,top:f.pageY});});}$("#"+c.id).scroll(function(){$("#"+c.id+"_fixedpanel").scrollTop($("#"+c.id).scrollTop());$("#"+c.id+"_hbar2").scrollLeft($("#"+c.id).scrollLeft());});$("#"+c.id+"_fixedpanel").scroll(function(){$(this).scrollLeft(0);});if(c.menu!=""){$("#"+c.id).bind("contextmenu",function(f){f.preventDefault();$("#"+c.menu).menu("show",{left:f.pageX,top:f.pageY});});}c.deletedrows="";return c;}function myGridKeyEvent(b,g,a){var m=g.which;var k=$("#"+a);var l=document.getElementById(a);var n=row=k.attr("xrow");var h=col=k.attr("xcol");var f=[];var c=[];var d=0;if(m==13||m==40||m==38||m==35||m==36){if(m==13){if(col<b.columns.length-1){col++;}else{if(row<b.rows-1){row++;}col=0;}}else{if(m==40){if(row<b.rows-1){row++;}else{if(b.append=="auto"){row=b.rows;b=myAppendGridRow(b);}else{col=0;}}}else{if(m==38){if(row>0){row--;}else{col=0;}}else{if(m==1136){row=0;col=0;}else{if(m==1135){row=b.rows-1;col=b.columns.length-1;}}}}}myFocus("cell_tmp");b=myCellFocus(b,row,col);}return b;}function myGridLocate(a,b){$("#r"+b+"_checkbox").prop("checked",true);a=myCellFocus(a,b,0);myGridCheckBoxChange(a,"r"+b+"c0",null);return a;}function myGridCheckBoxChange(a,d,c){if(a.select=="single"){if(d=="hr_checkbox"){$("#hr_checkbox").prop("checked",false);}else{mySetAllCheckbox(a,false);row=$("#"+d).attr("xrow");a=myCellFocus(a,row,0);}}else{if(d=="hr_checkbox"){var b=$("#hr_checkbox").is(":checked");mySetAllCheckbox(a,b);}else{mySetMasterCheckbox(a);}}return a;}function mySetAllCheckbox(b,c){for(var a=0;a<b.rows;a++){id="r"+a+"_checkbox";$("#"+id).prop("checked",c);}return b;}function mySetMasterCheckbox(b){if(b.select!="single"){var d=0;var c=0;for(var a=0;a<b.rows;a++){id="r"+a+"_checkbox";if($("#"+id).is(":checked")){d++;}else{c++;}}if(d==b.rows){$("#hr_checkbox").prop("checked",true);}else{if(c==b.rows){$("#hr_checkbox").prop("checked",false);}}}return b;}function myAppendGridRow(a){a=myCreateGridRows(a,a.rows,1);a=myCellFocus(a,a.rows,0);a.rows=a.rows+1;var b=(a.rowheight+0)*(a.rows-1)+0;$("#"+a.id).scrollTop(b);return a;}function myCreateGridRows(pmyGrid1,n0,n){var str="";var css="";var str1="";var str2="";var keyfieldset="";var deltay=parseInt(pmyGrid1.rowheight/2-8-2);for(var i=n0;i<n0+n;i++){var row=i;if(i>n0){keyfieldset+=";";}keyfieldset+="r_key"+i;mySetValue("r_key"+i,"");var top=(pmyGrid1.rowheight+0)*(row)+0;var left=0;var id="r"+row;if(pmyGrid1.rownumber){str1+='<div id="'+id+'_rowno" class="textgrid" style="text-align:center; line-height:'+(pmyGrid1.rowheight)+"px; background-color:#F4F4F4; width:"+(pmyGrid1.rownumberwidth)+"px; height:"+pmyGrid1.rowheight+'px;">';str1+=(row*1+1);str1+="</div>\n";css+='$("#'+id+'_rowno").css({position:"absolute",top:"'+(top)+'px",left:"'+(left)+'px"});';}if(pmyGrid1.checkbox){str1+='<div id="'+id+'_box" class="textgrid" style="padding:'+deltay+"px 0px "+deltay+"px 0px; text-align:center; height:"+(pmyGrid1.rowheight-2*deltay)+"px; width:"+(pmyGrid1.checkboxwidth)+'px;"><input type="checkbox" id="'+id+'_checkbox" style="height:16px;width:16px;"></div>\n';css+='$("#'+id+'_box").css({position:"absolute",top:"'+(top)+'px",left:"'+(left*1+pmyGrid1.rownumberwidth)+'px"});';css+='$("#'+id+'_checkbox").on("click", function(e) {	myGridCheckBoxChange(pmyGrid1,"'+id+'_checkbox",e);});';css+='$("#'+id+'_checkbox").attr("xrow",'+row+");\n";}left+=(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1);if(pmyGrid1.fixedfieldcol<0){left=0;}for(var j=0;j<pmyGrid1.columns.length;j++){var id="r"+row+"c"+j;var type=pmyGrid1.columns[j].type;var w=(pmyGrid1.columns[j].length-9);var align=pmyGrid1.columns[j].align;str2='<div id="'+id+'" class="textgrid" onclick="pmyGrid1=myCellFocus(pmyGrid1,'+row+","+j+')" class="textgrid" style="position:absolute; text-align:'+align+"; padding:0px 2px 0px 6px; line-height:"+(pmyGrid1.rowheight*1)+"px; height:"+(pmyGrid1.rowheight)+"px; width:"+(w)+"px; top:"+(top)+"px; left:"+(left)+'px;"></div>\n';css+='$("#'+id+'").attr("xtype","label");\n';css+='$("#'+id+'").attr("xcol",'+j+");\n";css+='$("#'+id+'").attr("xrow",'+row+");\n";if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){str1+=str2;left=0;}else{str+=str2;left+=1*pmyGrid1.columns[j].length;}}}$("#"+pmyGrid1.id).append($(str));$("#"+pmyGrid1.id+"_fixedpanel").append($(str1));eval(css);myHiddenFields(keyfieldset);vs=myhasVScrollBar(myGrid1.id);hs=myhasHScrollBar(myGrid1.id);var top=0;var left=1*(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1)-2+2;if(pmyGrid1.fixedfieldcol<0){left=0;}for(j=0;j<pmyGrid1.columns.length;j++){if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){left=0;}else{left+=1*pmyGrid1.columns[j].length;}}myAddHeaderScrollbar();return pmyGrid1;}function myAddHeaderScrollbar(){var top=0;var left=1*(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1)-2+2;if(pmyGrid1.fixedfieldcol<0){left=0;}for(j=0;j<pmyGrid1.columns.length;j++){if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){left=0;}else{left+=1*pmyGrid1.columns[j].length;}}vs=myhasVScrollBar(myGrid1.id);hs=myhasHScrollBar(myGrid1.id);var sw=0;var sh=0;var id="hr";if(vs&&hs){sw=scrollsize.width+2;}else{if(hs){sw=2;}}if(sw>0){var str='<div id="'+id+'_rownox" class="textgrid" style="background-color:#F4F4F4; text-align:left; width:'+(sw)+"px; height:"+(pmyGrid1.headerheight)+'px;">';var css='$("#'+id+'_rownox").css({position:"absolute",top:"'+(top)+'px",left:"'+(left)+'px","border-width":"1px"});';if($("#"+id+"_rownox").length>0){$("#"+id+"_rownox").remove();}$("#"+pmyGrid1.id+"_hbar2").append($(str));eval(css);}if(hs&&vs){sh=scrollsize.height;$("#"+pmyGrid1.id+"_fixedpanel").css({"overflow-x":"scroll"});}else{sh=0;$("#"+pmyGrid1.id+"_fixedpanel").css({"overflow-x":"hidden"});}}function myCreateGridHeader(pmyGrid1){var top=pmyGrid1.top;var left=0;var deltay=parseInt(pmyGrid1.headerheight/2-8-2);var str="";var css="";var str1="";var str2="";var id="hr";if(pmyGrid1.rownumber){str1+='<div id="'+id+'_rowno" class="textgrid" style="background-color:#F4F4F4; text-align:left; width:'+(pmyGrid1.rownumberwidth)+"px; height:"+(pmyGrid1.headerheight)+'px;"></div>\n';css+='$("#'+id+'_rowno").css({position:"absolute",top:"'+(top)+'px",left:"'+(left)+'px"});';}if(pmyGrid1.checkbox){str1+='<div id="'+id+'_box" class="textgrid" style="padding:'+deltay+"px 0px "+deltay+"px 0px; text-align:center; height:"+(pmyGrid1.headerheight-2*deltay)+"px; width:"+(pmyGrid1.checkboxwidth)+'px;"><input type="checkbox" id="'+id+'_checkbox" style="height:16px;width:16px;"></div>\n';css+='$("#'+id+'_box").css({position:"absolute",top:"'+(top)+'px",left:"'+(left*1+pmyGrid1.rownumberwidth)+'px"});';css+='$("#'+id+'_checkbox").on("click", function(e) {	myGridCheckBoxChange(pmyGrid1,"'+id+'_checkbox",e);});';css+='$("#'+id+'_checkbox").attr("xrow",-1);\n';}left=1*(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1)-2+2;if(pmyGrid1.fixedfieldcol<0){left=0;}for(j=0;j<pmyGrid1.columns.length;j++){id="hr_c"+j;str2='<div id="'+id+'" class="textgrid" style="text-align:center; line-height:'+pmyGrid1.headerheight+"px; position:absolute; background-color:#F4F4F4;";str2+="top:"+(top)+"px; left:"+(left)+"px;";str2+="height:"+(pmyGrid1.headerheight+0)+"px; width:"+(1*pmyGrid1.columns[j].length-1)+'px;">';str2+=pmyGrid1.columns[j].title;str2+="</div>\n";css+='$("#'+id+'").attr("xcol",'+j+");\n";css+='$("#'+id+'").attr("xrow","0");\n';if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){str1+=str2;left=0;}else{str+=str2;left+=1*pmyGrid1.columns[j].length;}}$("#"+pmyGrid1.id+"_hbar1").append($(str1));$("#"+pmyGrid1.id+"_hbar2").append($(str));eval(css);str="";css="";myTextField("cell_tmp",pmyGrid1.id,"",0,-10,-0,1,1,"","");var left=(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1)-4;if(pmyGrid1.fixedfieldcol<0){left=-4;}var j=0;for(var j=0;j<pmyGrid1.columns.length;j++){if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){parent=pmyGrid1.id+"_fixedpanel";}else{var parent=pmyGrid1.id;}var id="cell_"+j;var w=1*pmyGrid1.columns[j].length+1;var type=pmyGrid1.columns[j].type;if(type=="n"){var len=eval("pmyGrid1.length_"+pmyGrid1.columns[j].name);if(len==undefined){len=12;}var min=eval("pmyGrid1.min_"+pmyGrid1.columns[j].name);if(min==undefined){min=0;}var max=eval("pmyGrid1.max_"+pmyGrid1.columns[j].name);if(max==undefined){max=0;}myNumberField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w-4+4,len,pmyGrid1.columns[j].dec,0,min,max,"");}else{if(type=="d"){myDateField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w,"","");}else{if(type=="b"){var items=eval("pmyGrid1.items_"+pmyGrid1.columns[j].name);if(items==undefined){items="";}if(items.substr(0,3)=="[@]"){items=items.substring(3);myComboField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w,items,"","checkbox");}else{myComboField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w,items,"","");}}else{if(type=="x"){var style="";var sql=eval("pmyGrid1.sql_"+pmyGrid1.columns[j].name);if(sql==undefined){sql="";}if(sql!=""&&sql.substr(0,3)=="[@]"){style="checkbox";sql=sql.substring(3);}sql="select text as "+id+" from ("+sql+") as p";myDBComboField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w,sql,id,"",style);}else{myTextField(id,parent,"",0,top,left,pmyGrid1.rowheight*1+1,w,"");}}}}if(pmyGrid1.columns[j].name==pmyGrid1.keyfield||pmyGrid1.columns[j].name==pmyGrid1.fixedfield){left=-4;}else{left+=1*pmyGrid1.columns[j].length;}css+='$("#'+id+'").textbox("textbox").bind("blur",function(e){';css+='var row=$("#'+id+'").attr("xrow");';css+='var col=$("#'+id+'").attr("xcol");';css+="if (row>=0 && col>=0) mySetRowValue(pmyGrid1,row,col);";css+="});\n";css+='$("#'+id+'").textbox("textbox").bind("focus",function(e){';css+='xrow=$("#'+id+'").attr("xrow");';css+='xcol=$("#'+id+'").attr("xcol");';css+="pmyGrid1.rowindex=xrow;";css+="pmyGrid1.colindex=xcol;";css+='if (xcol==0) $("#"+pmyGrid1.id).scrollLeft(0);';if(pmyGrid1.clickonselect){if(pmyGrid1.select=="single"){css+="mySetAllCheckbox(pmyGrid1,false);";}css+='$("#r"+xrow+"_checkbox").prop("checked",true);';if(pmyGrid1.select!="single"){css+="mySetMasterCheckbox(pmyGrid1);";}}css+="});\n";css+='$("#'+id+'").attr("xcol",'+j+");\n";css+='$("#'+id+'").attr("xrow",-1);\n';css+='$("#'+id+'").textbox("textbox").bind("keydown",function(e){ myGridKeyEvent(pmyGrid1,e,"'+id+'"); });\n';}$("#"+pmyGrid1.id).append($(str));eval(css);$("#cell_0").textbox("textbox").bind("keyup",function(e){});for(var j=0;j<pmyGrid1.columns.length;j++){var id="cell_"+j;if(pmyGrid1.columns[j].readonly==1){mySetReadonly(id,true);}}return pmyGrid1;}function myInsertGridRow(d,e){d=myCreateGridRows(d,d.rows,1);d.rows++;for(var b=d.rows-1;b>=e;b--){var c=$("#r"+b+"_checkbox");var a=$("#r"+(b-1)+"_checkbox");c.prop("checked",a.is(":checked"));c.prop("checked",a.is(":checked"));c.attr("xrow",b);a.attr("xrow",b-1);mySetValue("r_key"+b,myGetValue("r_key"+(b-1)));for(j=0;j<d.columns.length;j++){c="r"+b+"c"+j;a="r"+(b-1)+"c"+j;if(b==e){mySetValue(c,"");}else{mySetValue(c,myGetValue(a));}$("#"+c).attr("xrow",b);$("#"+a).attr("xrow",b-1);$("#"+c).attr("xcol",j);$("#"+a).attr("xcol",j);}}mySetValue("r_key"+e,"");for(j=0;j<d.columns.length;j++){mySetValue("cell_"+j,"");}d=myCellFocus(d,e,0);return d;}function myDeleteGridRow(d,e){d.deletedrows+="	"+myGetValue("r_key"+e);var b=0;for(var b=e;b<d.rows-1;b++){var c=$("#r"+b+"_checkbox");var a=$("#r"+(b*1+1)+"_checkbox");c.prop("checked",a.is(":checked"));mySetValue("r_key"+b,myGetValue("r_key"+(1*b+1)));for(j=0;j<d.columns.length;j++){c="r"+b+"c"+j;a="r"+(b*1+1)+"c"+j;mySetValue(c,myGetValue(a));}}d.rows--;$("#r"+d.rows+"_rowno").remove();$("#r"+d.rows+"_box").remove();$("#r_key"+d.rows).remove();for(j=0;j<d.columns.length;j++){c="r"+e+"c"+j;mySetValue("cell_"+j,myGetValue(c));$("#r"+d.rows+"c"+j).remove();}myAddHeaderScrollbar();if(e==d.rows){e--;}d=myCellFocus(d,e,0);return d;}function mySaveGridRows(a){a.data=[];var b=0;var p="";var d=a.deletedrows.split("	");for(var e=1;e<d.length;e++){p+="delete "+a.tablename+" where "+a.keyfield+"='"+d[e]+"'\n";}for(var e=0;e<a.rows;e++){a.data[e]=[];var g=0;var n="insert into "+a.tablename+"(";var l=" values(";var h="update "+a.tablename+" set ";for(j=0;j<a.columns.length;j++){var c="r"+e+"c"+j;var m=myGetValue(c);if(j>0){n+=",";l+=",";h+=",";}n+=a.columns[j].name;l+="'"+m+"'";h+=a.columns[j].name+"='"+m+"'";if(m!=""){g=1;}a.data[e][j]=m;}if(g>0){var f=myGetValue("r_key"+e);if(f==""){p+=n+")"+l+")\n";}else{p+=h+" where "+a.keyfield+"='"+f+"'\n";}if(a.keyfieldcol>=0){mySetValue("r_key"+e,myGetValue("r"+e+"c"+a.keyfieldcol));}b++;}}var o=myRunUpdateSql(p);a=myCellFocus(a,0,0);$("#"+a.id).scrollLeft(0);$("#"+a.id).scrollTop(0);if(a.showsavemessage){myMessageShow("共"+b+"行数据已经保存成功！",240);}return a;}function myTextGridColumns(d){var h=[];fieldset=d.gridfields;var g=fieldset.split(";");for(var f=0;f<g.length;f++){h[f]={};h[f].name="";h[f].title="";h[f].align="";h[f].type="c";h[f].length="100";h[f].dec="0";h[f].fixed=0;h[f].readonly=0;var p=g[f].toLowerCase();var n=p.indexOf("[");var m=p.indexOf("]");if(n>=0&&m>n){var q=p.substring(n+1,m);var e=q.indexOf("^r");if(e>=0){h[f].readonly=1;q=q.replace("^r","");}var c=q.indexOf("@");if(c>=0){h[f].align=q.substr(c+1,1);q=q.replace("@"+h[f].align,"");}var b=q.indexOf("%");if(b>=0){h[f].type=q.substr(b+1,1);q=q.replace("%"+h[f].type,"");}var a=q.indexOf("#");var l="";var k="";if(a>=0){l=q.substring(a+1,255);}else{l=q;}var o=l.indexOf(",");if(o<0){h[f].length=l;}else{h[f].length=l.substring(0,o);h[f].dec=l.substr(o+1,2);}p=p.substring(m+1,255);}var c=p.indexOf("/");if(c>0){h[f].title=p.substring(0,c);h[f].name=p.substring(c+1);}else{h[f].title=p;h[f].name=p;}if(h[f].align==""&&h[f].type=="d"){h[f].align="c";}if(h[f].align==""&&h[f].type=="n"){h[f].align="r";}if(h[f].align==""&&h[f].type=="f"){h[f].align="r";}if(h[f].align=="c"){h[f].align="center";}else{if(h[f].align=="r"){h[f].align="right";}else{h[f].align="left";}}}d.columns=h;return d;}function myLoadTextGridData(pmyGrid1){pmyGrid1.deletedrows="";pmyGrid1.data=[];$.ajax({type:"Post",url:"system/easyui_getGridData.jsp",data:{selectsql:myToXcode(pmyGrid1.activesql),keyfield:pmyGrid1.keyfield,sortfield:pmyGrid1.sortfield,limit:pmyGrid1.pagesize,start:(pmyGrid1.pagenumber-1)*pmyGrid1.pagesize,summeryfields:""},async:false,method:"post",success:function(data){eval("var source="+data+";");var records=source.rows;var i=0;for(i=pmyGrid1.rows;i<records.length;i++){pmyGrid1=myAppendGridRow(pmyGrid1);pmyGrid1.rowindex=0;}for(i=0;i<records.length;i++){pmyGrid1.data[i]=[];for(var j=0;j<pmyGrid1.columns.length;j++){c1="r"+i+"c"+j;c2=eval("records[i]."+pmyGrid1.columns[j].name);mySetValue(c1,c2);pmyGrid1.data[i][j]=c2;}mySetValue("r_key"+i,eval("records[i]."+pmyGrid1.keyfield));}while(i<pmyGrid1.rows){for(j=0;j<pmyGrid1.columns.length;j++){c1="r"+i+"c"+j;mySetValue(c1,"");}mySetValue("r_key"+i,"");i++;}pmyGrid1.rowcount=Math.max(records.length,pmyGrid1.rows);if(pmyGrid1.rowindex<0||pmyGrid1.rowindex>=pmyGrid1.rows){pmyGrid1.rowindex=0;}}});$("#cell_0").attr("xrow",-1);pmyGrid1=myCellFocus(pmyGrid1,pmyGrid1.rowindex,0);$("#"+pmyGrid1.id).scrollLeft(0);$("#"+pmyGrid1.id).scrollTop(0);return pmyGrid1;}function myBlankTextGrid(b,c){if(c==0){c=b.rows;}for(var a=0;a<b.rows&&a<c;a++){for(j=0;j<b.columns.length;j++){c1="r"+a+"c"+j;mySetValue(c1,"");}}while(a<b.rows){$("#r"+a+"_rowno").remove();$("#r"+a+"_box").remove();for(j=0;j<b.columns.length;j++){$("#r"+a+"c"+j+"_div").remove();}a++;}while(a<c){myAppendGridRow(b);a++;}b.rows=c;b=myCellFocus(b,0,0);return b;}function mySetRowValue(b,c,d){if(c>=0&&c<b.rows){if(d>=0){var e="cell_"+d;mySetValue("r"+c+"c"+d,myGetValue(e));}else{for(var a=0;a<b.columns.length;a++){var e="cell_"+a;mySetValue("r"+c+"c"+a,myGetValue(e));}}}}function myCellFocus(pmyGrid1,row,col){var row0=$("#cell_0").attr("xrow");var col0=$("#cell_0").attr("xcol");if(row0!=row&&row>=0){var keyvalue=myGetValue("cell_"+col0);if(col0==pmyGrid1.fixedfieldcol&&keyvalue!=""&&pmyGrid1.columns[col0].readonly==0&&pmyGrid1.columns[col0].name==pmyGrid1.keyfield){var flag=false;for(var i=0;i<pmyGrid1.rows;i++){if(myGetValue("r"+i+"c"+col0)==keyvalue&&i!=row0){flag=true;break;}}}if(flag){col=col0;row=row0;var f='myFocus("cell_'+col0+'")';myMessage(pmyGrid1.columns[col0].title+"值重复！","error",0,f);}else{mySetRowValue(pmyGrid1,row0,-1);var top=(pmyGrid1.rowheight+0)*(row);var left=pmyGrid1.left-4+(pmyGrid1.rownumberwidth+pmyGrid1.checkboxwidth+1);var css="";for(var j=0;j<pmyGrid1.columns.length;j++){var id="cell_"+j;var type=pmyGrid1.columns[j].type;css+='$("#'+id+'_div").css({top:"'+(top)+'px"});\n';css+='$("#'+id+'").attr("xrow",'+row+");\n";mySetValue(id,myGetValue("r"+row+"c"+j));}eval(css);}}if(row>=0&&col>=0){mySelectOnFocus();$("#cell_"+col).attr("xrow",row);$("#cell_"+col).attr("xcol",col);pmyGrid1.colindex=col;pmyGrid1.rowindex=row;if(col==0){$("#"+pmyGrid1.id).scrollLeft(0);}myFocus("cell_"+col);}if(col==0){$("#"+pmyGrid1.id).scrollTop($("#"+pmyGrid1.id+"_fixedpanel").scrollTop());}return pmyGrid1;}function myCopyGridRow(b){b.copyvalues=[];for(var a=0;a<b.columns.length;a++){var c="cell_"+a;b.copyvalues.push(myGetValue(c));}return b;}function myPasteGridRow(b){if(b.copyvalues!=undefined){for(var a=0;a<b.columns.length;a++){var c="cell_"+a;if(b.columns[a].readonly==0){mySetValue(c,b.copyvalues[a]);}}}}function myBlankGridRow(b){for(var a=0;a<b.columns.length;a++){var c="cell_"+a;if(b.columns[a].readonly==0){mySetValue(c,"");}}}function myTextGridUpdatedFlag(e){flag=0;if(e.data.length==0||e.rows==0){return 0;}if(e.rows!=e.data.length||e.data.length==0){flag=1;}if(e.deletedrows!=""){var c=e.deletedrows.split("	");for(var b=1;b<c.length;b++){if(c[b]!=""){flag++;break;}}}for(var b=0;b<e.rows;b++){for(var a=0;a<e.columns.length;a++){var d="r"+b+"c"+a;if(myGetValue(d)!=e.data[b][a]){flag++;break;}}if(flag>0){break;}}if(flag>0){if(e.autorowsave){e=mySaveGridRows(e);}else{$.messager.confirm({title:"系统提示",msg:myConfirmMessage("是否保存本次操作数据？"),width:280,height:160,fn:function(f){if(f){e=mySaveGridRows(e);myMessageEvent("confirm","yes");}else{myMessageEvent("confirm","no");}}});}}return flag;}function doGetCaretPosition(b){var c=0;if(document.selection){b.focus();var a=document.selection.createRange();a.moveStart("character",-b.value.length);c=a.text.length;}else{if(b.selectionStart||b.selectionStart=="0"){c=b.selectionStart;}}return c;}function f1(a){var b=a.value;return(b.slice(0,a.selectionStart).length);}function myHideScrollbar(b,a){tmp=b.split(";");for(var c=0;c<tmp.length;c++){$("#"+tmp[c]).css({overflow:a});}}function myGetScrollbarWidth(){var d=document.createElement("div");d.style.visibility="hidden";d.style.width="100px";d.style.msOverflowStyle="scrollbar";document.body.appendChild(d);var b=d.offsetWidth;d.style.overflow="scroll";var a=document.createElement("div");a.style.width="100%";d.appendChild(a);var c=a.offsetWidth;d.parentNode.removeChild(d);return b-c;}function myhasVScrollBar(b){var a=0;if($("#"+b).get(0).scrollWidth+a>$("#"+b).innerWidth()){a=scrollsize.height;}return $("#"+b).get(0).scrollHeight+a>$("#"+b).innerHeight();}function myhasHScrollBar(b){var a=0;if($("#"+b).get(0).scrollHeight>$("#"+b).innerHeight()){a=scrollsize.width;}return($("#"+b).get(0).scrollWidth+a>$("#"+b).innerWidth());}(function(a,b){a.fn.getCursorPosition=function(){var e=a(this).get(0);var f=0;if("selectionStart" in e){f=e.selectionStart;}else{if("selection" in document){e.focus();var c=document.selection.createRange();var d=document.selection.createRange().text.length;c.moveStart("character",-e.value.length);f=c.text.length-d;}}return f;};})(jQuery);