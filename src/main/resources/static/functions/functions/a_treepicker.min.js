Ext.onReady(function(){var o=2372;var s=20;var l="localhost	19910101	crmlab";var q="select *, (rtrim(menuID) + ' ' + menuTitle) as nodetext from sys_menu";var f="select sysid,menuid,menutitle,servicefile,menuurl,parentnodeid,isparentflag,level,(rtrim(menuID) + ' ' + menuTitle) as nodetext from sys_menu";var d="select sysid,menuid,menutitle,servicefile,menuurl,parentnodeid,isparentflag,level,(rtrim(menuID) + ' ' + menuTitle) as nodetext, 0 as syschecked from sys_menu";var c="select areaid,areaname,parentnodeid,isparentflag,level,(rtrim(areaID) + ' ' + areaName) as nodetext from areas";pmyTree1={};pmyTree1.selectedcode="";pmyTree1.rootcode="";pmyTree1.searchtext="";pmyTree1.filterfield="";pmyTree1.events="storeload;treeload";pmyTree1.sql="";pmyTree1.parentvalue="";pmyTree1.keyfield="";pmyTree1.reloadflag=1;pmyTree1.singleexpand="true";pmyTree1.title="客户分组";pmyTree1.roottitle="全部客户";pmyTree1.tbar="";pmyTree1.bbar="";pmyTree1.height=0;pmyTree1.width=200;pmyTree1.fieldset="cid;text;nodetext;level;sysnumber:int";pmyTree1.name="myTree1";pmyTree1.varname="pmyTree1";pmyTree1.groupidset="province@provinceid/所在省份;city@cityid/所在城市;type/客户类别;industry/所属行业;source/客户来源;status/客户状态;-;*/取消分组";pmyTree1.groupid="";pmyTree1.groupfield=[];var w=Ext.create("Ext.data.TreeStore",{nodeParam:"rootCode",fields:[{name:"id",type:"string",mapping:"cid"},{name:"sysid",type:"int"},{name:"text",type:"string"},{name:"menuid",type:"string"},{name:"menutitle",type:"string"},{name:"servicefile",type:"string"},{name:"menuurl",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:s,tableName:"sys_menu",keyField:"menuID",sqlString:f,selectedCode:"",searchText:""});}}});var g=Ext.create("Ext.ux.MyTreePicker",{id:"myTreePicker",name:"myTreePicker",fieldLabel:"1.分层展开",fieldStyle:{textDecoration:"underline"},style:{textDecoration:"underline"},width:480,labelWidth:65,labelSeparator:":",displayField:"text",valueField:"id",searchFields:["menuid","servicefile","nodetext"],store:w,rootVisible:false});var r=Ext.create("Ext.data.TreeStore",{nodeParam:"rootCode",fields:[{name:"id",type:"string",mapping:"cid"},{name:"sysid",type:"int"},{name:"text",type:"string"},{name:"menuid",type:"string"},{name:"menutitle",type:"string"},{name:"servicefile",type:"string"},{name:"menuurl",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:o,tableName:"sys_menu",keyField:"menuID",sqlString:f,selectedCode:"",searchText:""});}}});var n=Ext.create("Ext.ux.MyTreePicker",{id:"xmyTreePicker",name:"xmyTreePicker",fieldLabel:"2.全部展开",width:480,labelWidth:65,labelSeparator:":",displayField:"text",store:r,rootVisible:false});var t=Ext.create("Ext.data.TreeStore",{nodeParam:"rootCode",fields:[{name:"id",type:"string",mapping:"cid"},{name:"sysid",type:"int"},{name:"text",type:"string"},{name:"menuid",type:"string"},{name:"menutitle",type:"string"},{name:"servicefile",type:"string"},{name:"menuurl",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:s,tableName:"sys_menu",keyField:"menuID",sqlString:f,selectedCode:"",searchText:""});}}});var x=Ext.create("Ext.ux.MyTreePicker",{id:"lmyTreePicker",name:"lmyTreePicker",fieldLabel:"3.分层展开+只允许选择叶子节点",width:480,labelWidth:180,labelSeparator:":",displayField:"text",store:t,rootVisible:false,leafSelectOnly:true});var h=Ext.create("Ext.data.TreeStore",{nodeParam:"rootCode",fields:[{name:"id",type:"string",mapping:"cid"},{name:"sysid",type:"int"},{name:"text",type:"string"},{name:"menuid",type:"string"},{name:"menutitle",type:"string"},{name:"servicefile",type:"string"},{name:"menuurl",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:s,tableName:"sys_menu",keyField:"menuID",sqlString:d,selectedCode:"",searchText:""});}}});var u=Ext.create("Ext.ux.MyTreePicker",{id:"cmyTreePicker",name:"cmyTreePicker",fieldLabel:"4.分层展开+复选框单选",width:480,labelWidth:145,labelSeparator:":",displayField:"text",store:h,rootVisible:false});var e=Ext.create("Ext.data.TreeStore",{nodeParam:"rootCode",fields:[{name:"id",type:"string",mapping:"cid"},{name:"sysid",type:"int"},{name:"text",type:"string"},{name:"areaname",type:"string"},{name:"areaid",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:s,tableName:"areas",keyField:"areaID",sqlString:c,selectedCode:"",searchText:""});}}});var a=Ext.create("Ext.ux.MyTreePicker",{id:"mcmyTreePicker",name:"mcmyTreePicker",fieldLabel:"5.分层展开+全路径(只读)",width:480,labelWidth:145,labelSeparator:":",displayField:"text",store:e,rootVisible:false,showFullPath:true});var k=Ext.create("Ext.form.Panel",{title:"TreePicker",region:"center",padding:"0 5 0 5",bodyPadding:5,items:[{xtype:"fieldset",width:"100%",height:"100%",title:"TreePicker测试",items:[g,n,x,u,a,{xtype:"displayfield",fieldStyle:{textDecoration:"underline",color:"red"},fieldLabel:"注",labelWidth:12,value:"为简便起见，全路径的TreePicker是只读的"}]}]});g.setValue("0201");n.setValue("订单查询");x.setValue("0203");u.setValue("0101");a.setValue("330782");var m=Ext.create("Ext.form.Panel",{title:"测试面板",region:"south",bodyPadding:5,height:160,padding:"5 0 0",items:[{xtype:"textfield",id:"myValue",name:"myValue",fieldLabel:"Value值",labelWidth:90,width:480},{xtype:"textfield",id:"myRawValue",name:"myRawValue",fieldLabel:"RawValue值",labelWidth:90,width:480},{xtype:"textfield",id:"mysetValue",name:"mysetValue",fieldLabel:"设值",labelWidth:90,width:480}],buttonAlign:"left",buttons:[{xtype:"button",text:"#1设值",style:{marginLeft:"2px"},handler:function(){var y=Ext.getCmp("mysetValue").getValue();g.setValue(y);}},{xtype:"button",text:"#1取值",handler:function(){Ext.getCmp("myValue").setValue("["+g.getValue()+"]");Ext.getCmp("myRawValue").setValue("["+g.getRawValue()+"]");}},{xtype:"button",text:"#2取值",style:{marginLeft:"2px"},handler:function(){Ext.getCmp("myValue").setValue("["+n.getValue()+"]");Ext.getCmp("myRawValue").setValue("["+n.getRawValue()+"]");}},{xtype:"button",text:"#3取值",style:{marginLeft:"2px"},handler:function(){Ext.getCmp("myValue").setValue("["+x.getValue()+"]");Ext.getCmp("myRawValue").setValue("["+x.getRawValue()+"]");}},{xtype:"button",text:"#4取值",style:{marginLeft:"2px"},handler:function(){Ext.getCmp("myValue").setValue("["+u.getValue()+"]");Ext.getCmp("myRawValue").setValue("["+u.getRawValue()+"]");}},{xtype:"button",text:"#5取值",style:{marginLeft:"2px"},handler:function(){Ext.getCmp("myValue").setValue("["+a.getValue()+"]");Ext.getCmp("myRawValue").setValue("["+a.getRawValue()+"]");}}]});var b=Ext.create("Ext.data.TreeStore",{autoLoad:true,fields:[{name:"id",type:"string",mapping:"cid"},{name:"text",type:"string"},{name:"areaid",type:"string"},{name:"areaname",type:"string"},{name:"flag",type:"string"},{name:"isparentflag",type:"int"},{name:"parentnodeid",type:"string"},{name:"level",type:"string"}],proxy:{type:"ajax",url:"system//fn_getTreeNodes.jsp",reader:{type:"json"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},root:{name:"root",text:"根节点",expanded:true,id:""},listeners:{beforeload:function(y){Ext.apply(y.proxy.extraParams,{database:l,maxReturnNumber:o,tableName:"sys_menu",keyField:"menuID",sqlString:q,selectedCode:"",searchText:""});}}});var j=Ext.create("Ext.tree.Panel",{rootCode:"",selectedCode:"",title:"树面板",region:"west",width:200,store:b,useArrows:true,listeners:{itemmouseenter:function(z,y,B,A,C){this.rootCode=y.data.cid;selectedCode="";},itemclick:function(z,y,B,A,C){v(y);}}});var i=Ext.create("Ext.panel.Panel",{title:"主面板",region:"east",width:500,html:'<iframe name="mainframe" id="mainframe" width="100%" height="100%" frameborder="no" border="0" style="margin:0 auto; text-align:center"></iframe>'});Ext.create("Ext.Viewport",{layout:"border",padding:5,items:[k,j,m,i]});function v(D){var B=D.get("isparentflag");var z="xml/"+D.raw.servicefile;var y=D.raw.menuurl;if(B==0&&z!=""){var H=new Compiler();window.p=H.compiler(z);if(p!=false){var A=p.type+".jsp";var C=Ext.Object.toQueryString(p,true);var F="tmpform";var G=Ext.get(F);if(Ext.isEmpty(G)){G=document.createElement("form");G.setAttribute("id",F);G.setAttribute("hidden",true);G.setAttribute("target","mainframe");G.setAttribute("method","POST");var E=document.createElement("input");E.setAttribute("id","p");E.setAttribute("name","p");E.setAttribute("type","text");G.appendChild(E);document.body.appendChild(G);G=Ext.get(F);}G.dom.setAttribute("action",A);Ext.get("p").dom.value=C;G.dom.submit();}else{alert("发生错误啦，可能XML文件找不到!");}}}});