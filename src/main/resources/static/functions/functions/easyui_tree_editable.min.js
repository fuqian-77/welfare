function myUpdateNode(tree1,field,value){var roots=tree1.tree("getRoots");for(var i=0;i<roots.length;i++){var cnodes=tree1.tree("getChildren",roots[i].target);eval("roots[i]."+field+'="'+value+'";');tree1.tree("update",roots[i]);for(var j=0;j<cnodes.length;j++){eval("cnodes[j]."+field+'="'+value+'";');tree1.tree("update",cnodes[j]);}}return tree1;}function mySaveNodes(pmyTree1){date1=myLocalTime("sec");if(pmyTree1.identityfield==undefined){pmyTree1.identityfield="sysid";}fieldset=myEditableFields(pmyTree1.tablename);var n=1;var sql="delete "+pmyTree1.tablename;sql+=" where "+pmyTree1.identityfield+" in (select "+pmyTree1.identityfield+" from ("+pmyTree1.sql+") as p)\n";myRunUpdateSql("",sql);sql="";sqlx=fieldset[0].insertsql+" \n";var roots=$("#"+pmyTree1.id).tree("getRoots");for(var i=0;i<roots.length;i++){var cnodes=$("#"+pmyTree1.id).tree("getChildren",roots[i].target);if(roots[i].id!="*"&&roots[i].id!=""){eval("roots[i]."+pmyTree1.keyfield+"=n;");roots[i].orderno=n;roots[i].id=n;roots[i].level=1;roots[i].parentnodeid="";roots[i].ancester="";if(cnodes.length>0){roots[i].isparentflag=1;}else{roots[i].isparentflag=0;}$("#"+pmyTree1.id).tree("update",roots[i]);str=fieldset[0].insertsql+"values("+mySqlFromRecord(fieldset,roots[i]).insertsql+")";sql+="	"+str+" \n";if(n>1){sqlx+="\n union all ";}sqlx+="select "+mySqlFromRecord(fieldset,roots[i]).insertsql+" ";if(n==1){pmyTree1.total=roots[i].total;}n++;}else{roots[i].level=0;roots[i].parentnodeid="";roots[i].ancester="";$("#"+pmyTree1.id).tree("update",roots[i]);}for(var j=0;j<cnodes.length;j++){pnode=$("#"+pmyTree1.id).tree("getParent",cnodes[j].target);if(pnode.id=="*"){pid="";}else{pid=pnode.id;}if($("#"+pmyTree1.id).tree("isLeaf",cnodes[j].target)){cnodes[j].isparentflag=0;}else{cnodes[j].isparentflag=1;}eval("cnodes[j]."+pmyTree1.keyfield+"=n;");cnodes[j].id=n;cnodes[j].orderno=n;cnodes[j].level=1*pnode.level+1;cnodes[j].parentnodeid=pid;if(pnode.ancester!=""){cnodes[j].ancester=pnode.ancester+"";}else{cnodes[j].ancester="";}if(pid!=""){cnodes[j].ancester+=pid+"#";}$("#"+pmyTree1.id).tree("update",cnodes[j]);str=fieldset[0].insertsql+"values("+mySqlFromRecord(fieldset,cnodes[j]).insertsql+")";sql+="	"+str+" \n";if(n>1){sqlx+="\n union all ";}sqlx+="select "+mySqlFromRecord(fieldset,cnodes[j]).insertsql+"	";n++;}}pmyTree1.lastnode=null;myRunUpdateSql("",sql);date2=myLocalTime("sec");console.log(date2-date1);myMessageShow("数据已经保存成功！");return pmyTree1;}function myDeleteNode(pmyTree1){if(pmyTree1.identityfield==undefined){pmyTree1.identityfield="sysid";}tree1=$("#"+pmyTree1.id);var node=$("#"+pmyTree1.id).tree("getSelected");pmyTree1.lastnode=null;if(node==null&&node.id=="*"){return pmyTree1;}sysid=eval("node."+pmyTree1.identityfield);var orderno=node.orderno;var msg="["+node.text+"]@n@n是否确定删除";if(node.isparentflag==1){msg+="这级目录？";}else{msg+="这个目录？";}$.messager.confirm({title:"系统提示",msg:myConfirmMessage(msg),width:350,fn:function(r){if(r){var newnode=myFindTreeNode(pmyTree1.id,node);if(newnode.nextnode!=null){var node1=newnode.nextnode;}else{if(newnode.priornode!=null){var node1=newnode.priornode;}else{var node1=newnode.parentnode;if(node1!=null){node1.isparentflag=0;$("#"+pmyTree1.id).tree("update",node1);}}}$("#"+pmyTree1.id).tree("remove",node.target);if(node1!=null){$("#"+pmyTree1.id).tree("select",node1.target);}}}});return pmyTree1;}function myMoveTreeNode(l,b){if(l.identityfield==undefined){l.identityfield="sysid";}tree1=$("#"+l.id);l.lastnode=null;var p=tree1.tree("getSelected");var j=tree1.tree("getParent",p.target);console.log(j);if(p.id=="*"||j==null){return l;}var o=null;var g=tree1.tree("getChildren",j.target);console.log(g);var d=[];for(var f=0;f<g.length;f++){if(g[f].level==p.level){d.push(g[f]);}}console.log(d);for(var f=0;f<d.length;f++){console.log(d[f].id,p.id);if(d[f].id==p.id){if(f>0&&b=="up"){o=d[f-1];}else{if(f<d.length-1&&b=="down"){o=d[f+1];}}break;}}if(o!=null){var n=p.id;var m=o.id;var k=tree1.tree("getChildren",p.target);var h=tree1.tree("getChildren",o.target);if(b=="up"){var c=tree1.tree("getData",p.target);tree1.tree("remove",p.target);tree1.tree("insert",{before:o.target,data:c});}else{if(b=="down"){var a=tree1.tree("getData",o.target);tree1.tree("remove",o.target);tree1.tree("insert",{before:p.target,data:a});}}var e=tree1.tree("find",n);if(e){tree1.tree("select",e.target);}}return l;}function myAddTreeNode(c,b){if(c.identityfield==undefined){c.identityfield="sysid";}if(c.totalnodes==undefined){c.totalnodes=1;}tree1=$("#"+c.id);var a=tree1.tree("getRoot");var d=tree1.tree("getSelected");c.lastnode=d;tree1.tree("expand",d.target);if(b=="add"||b=="insert"){var e=tree1.tree("getParent",d.target);}else{var e=d;}if(e==null||e.id=="*"){level=1;}else{level=1*e.level+1;}if(b=="insert"){tree1.tree("insert",{before:d.target,data:[{id:"_"+c.totalnodes,text:"",level:level}]});}else{b="add";tree1.tree("append",{parent:e.target,data:[{id:"_"+c.totalnodes,text:"",level:level}]});}var d=tree1.tree("find","_"+c.totalnodes);tree1.tree("select",d.target);c.addoredit=b;c.totalnodes++;return c;}function myRemoveBlankTreeNode(b,a){if(b.identityfield==undefined){b.identityfield="sysid";}tree1=$("#"+b.id);if(b.selectednode!=null&&b.selectednode.text==""){pnode=tree1.tree("getParent",b.selectednode.target);tree1.tree("remove",b.selectednode.target);if(a!="edit"&&b.lastnode!=null){tree1.tree("select",b.lastnode.target);}else{if(pnode!=null){tree1.tree("select",pnode.target);}}}return b;}