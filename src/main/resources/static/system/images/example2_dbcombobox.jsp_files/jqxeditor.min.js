(function(d){d.jqx.jqxWidget("jqxEditor","",{});d.extend(d.jqx._jqxEditor.prototype,{defineInstance:function(){var a={width:null,height:null,disabled:false,pasteMode:"html",editable:true,lineBreak:"default",toolbarPosition:"top",commands:{bold:{tooltip:"Bold",command:"bold",type:"toggleButton"},italic:{tooltip:"Italic",command:"italic",type:"toggleButton"},underline:{tooltip:"Underline",command:"underline",type:"toggleButton"},format:{placeHolder:"Format Block",tooltip:"Format Block",command:"formatblock",value:[{value:"p",label:"Paragraph"},{value:"h1",label:"Header 1"},{value:"h2",label:"Header 2"},{value:"h3",label:"Header 3"},{value:"h4",label:"Header 4"}],type:"list",width:120,dropDownWidth:190,height:25},font:{placeHolder:"Font",tooltip:"Font Name",command:"fontname",value:[{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Comic Sans MS",value:'"Comic Sans MS", cursive, sans-serif'},{label:"Courier New",value:'"Courier New", Courier, monospace'},{label:"Georgia",value:"Georgia,serif"},{label:"Impact",value:"Impact,Charcoal,sans-serif"},{label:"Lucida Console",value:"'Lucida Console',Monaco,monospace"},{label:"Tahoma",value:"Tahoma,Geneva,sans-serif"},{label:"Times New Roman",value:"'Times New Roman',Times,serif"},{label:"Trebuchet MS",value:'"Trebuchet MS",Helvetica,sans-serif'},{label:"Verdana",value:"Verdana,Geneva,sans-serif"}],type:"list",width:160,height:25,dropDownWidth:160},size:{placeHolder:"Size",tooltip:"Font Size",command:"fontsize",value:[{label:"1 (8pt)",value:"xx-small"},{label:"2 (10pt)",value:"x-small"},{label:"3 (12pt)",value:"small"},{label:"4 (14pt)",value:"medium"},{label:"5 (18pt)",value:"large"},{label:"6 (24pt)",value:"x-large"},{label:"7 (36pt)",value:"xx-large"}],type:"list",width:45,height:25,dropDownWidth:160},color:{tooltip:"Text Color",command:"forecolor",value:"#000",type:"colorPicker"},background:{tooltip:"Fill Color",command:"backcolor",value:"#fff",type:"colorPicker"},left:{tooltip:"Align Left",command:"justifyleft",type:"toggleButton"},center:{tooltip:"Align Center",command:"justifycenter",type:"toggleButton"},right:{tooltip:"Align Right",command:"justifyright",type:"toggleButton"},outdent:{tooltip:"Indent Less",command:"outdent",type:"button"},indent:{tooltip:"Indent More",command:"indent",type:"button"},ul:{tooltip:"Insert unordered list",command:"insertunorderedlist",type:"toggleButton"},ol:{tooltip:"Insert ordered list",command:"insertorderedlist",type:"toggleButton"},image:{tooltip:"Insert image",command:"insertimage",type:"button"},link:{tooltip:"Insert link",command:"createlink",type:"toggleButton"},html:{tooltip:"View source",command:"viewsource",type:"toggleButton"},clean:{tooltip:"Remove Formatting",command:"removeformat",type:"button"}},createCommand:null,defaultLocalization:{bold:"Bold",italic:"Italic",underline:"Underline",format:"Format Block",font:"Font Name",size:"Font Size",color:"Text Color",background:"Fill Color",left:"Align Left",center:"Align Center",right:"Align Right",outdent:"Indent Less",indent:"Indent More",ul:"Insert unordered list",ol:"Insert ordered list",image:"Insert image",link:"Insert link",html:"View source",clean:"Remove Formatting",Remove:"Remove",Ok:"Ok",Cancel:"Cancel",Change:"Change","Go to link":"Go to link","Open in a new window/tab":"Open in a new window/tab",Align:"Align",VSpace:"VSpace",HSpace:"HSpace",Width:"Width",Height:"Height",Title:"Title",URL:"URL","Insert Image":"Insert Image","Insert Link":"Insert Link","Alt Text":"Alt Text","not set":"&ltnot set&gt",Left:"Left",Right:"Right",Paragraph:"Paragraph",Header:"Header",Arial:"Arial","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Georgia:"Georgia",Impact:"Impact","Lucida Console":"Lucida Console",Tahoma:"Tahoma","Times New Roman":"Times New Roman","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"},localization:null,tools:"bold italic underline | format font size | color background | left center right | outdent indent | ul ol | image | link | clean | html",readOnly:false,stylesheets:new Array(),rtl:false,colorPickerTemplate:'<div class="jqx-editor-color-picker"><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (0, 0, 0)"><div title="RGB (0, 0, 0)" style="background-color: rgb(0, 0, 0);"></div></td><td aria-label="RGB (68, 68, 68)"><div title="RGB (68, 68, 68)" style="background-color: rgb(68, 68, 68);"></div></td><td aria-label="RGB (102, 102, 102)"><div title="RGB (102, 102, 102)" style="background-color: rgb(102, 102, 102);"></div></td><td aria-label="RGB (153, 153, 153)"><div title="RGB (153, 153, 153)" style="background-color: rgb(153, 153, 153);"></div></td><td aria-label="RGB (204, 204, 204)"><div title="RGB (204, 204, 204)" style="background-color: rgb(204, 204, 204);"></div></td><td aria-label="RGB (238, 238, 238)"><div title="RGB (238, 238, 238)" style="background-color: rgb(238, 238, 238);"></div></td><td aria-label="RGB (243, 243, 243)"><div title="RGB (243, 243, 243)" style="background-color: rgb(243, 243, 243);"></div></td><td aria-label="RGB (255, 255, 255)"><div title="RGB (255, 255, 255)" style="background-color: rgb(255, 255, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (255, 0, 0)"><div title="RGB (255, 0, 0)" style="background-color: rgb(255, 0, 0);"></div></td><td aria-label="RGB (255, 153, 0)"><div title="RGB (255, 153, 0)" style="background-color: rgb(255, 153, 0);"></div></td><td aria-label="RGB (255, 255, 0)"><div title="RGB (255, 255, 0)" style="background-color: rgb(255, 255, 0);"></div></td><td aria-label="RGB (0, 255, 0)"><div title="RGB (0, 255, 0)" style="background-color: rgb(0, 255, 0);"></div></td><td aria-label="RGB (0, 255, 255)"><div title="RGB (0, 255, 255)" style="background-color: rgb(0, 255, 255);"></div></td><td aria-label="RGB (0, 0, 255)"><div title="RGB (0, 0, 255)" style="background-color: rgb(0, 0, 255);"></div></td><td aria-label="RGB (153, 0, 255)"><div title="RGB (153, 0, 255)" style="background-color: rgb(153, 0, 255);"></div></td><td aria-label="RGB (255, 0, 255)"><div title="RGB (255, 0, 255)" style="background-color: rgb(255, 0, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (244, 204, 204)"><div title="RGB (244, 204, 204)" style="background-color: rgb(244, 204, 204);"></div></td><td aria-label="RGB (252, 229, 205)"><div title="RGB (252, 229, 205)" style="background-color: rgb(252, 229, 205);"></div></td><td aria-label="RGB (255, 242, 204)"><div title="RGB (255, 242, 204)" style="background-color: rgb(255, 242, 204);"></div></td><td aria-label="RGB (217, 234, 211)"><div title="RGB (217, 234, 211)" style="background-color: rgb(217, 234, 211);"></div></td><td aria-label="RGB (208, 224, 227)"><div title="RGB (208, 224, 227)" style="background-color: rgb(208, 224, 227);"></div></td><td aria-label="RGB (207, 226, 243)"><div title="RGB (207, 226, 243)" style="background-color: rgb(207, 226, 243);"></div></td><td aria-label="RGB (217, 210, 233)"><div title="RGB (217, 210, 233)" style="background-color: rgb(217, 210, 233);"></div></td><td aria-label="RGB (234, 209, 220)"><div title="RGB (234, 209, 220)" style="background-color: rgb(234, 209, 220);"></div></td></tr><tr><td id="T-Kw-Jn88" aria-label="RGB (234, 153, 153)"><div title="RGB (234, 153, 153)" style="background-color: rgb(234, 153, 153);"></div></td><td aria-label="RGB (249, 203, 156)"><div title="RGB (249, 203, 156)" style="background-color: rgb(249, 203, 156);"></div></td><td aria-label="RGB (255, 229, 153)"><div title="RGB (255, 229, 153)" style="background-color: rgb(255, 229, 153);"></div></td><td aria-label="RGB (182, 215, 168)"><div title="RGB (182, 215, 168)" style="background-color: rgb(182, 215, 168);"></div></td><td aria-label="RGB (162, 196, 201)"><div title="RGB (162, 196, 201)" style="background-color: rgb(162, 196, 201);"></div></td><td aria-label="RGB (159, 197, 232)"><div title="RGB (159, 197, 232)" style="background-color: rgb(159, 197, 232);"></div></td><td aria-label="RGB (180, 167, 214)"><div title="RGB (180, 167, 214)" style="background-color: rgb(180, 167, 214);"></div></td><td aria-label="RGB (213, 166, 189)"><div title="RGB (213, 166, 189)" style="background-color: rgb(213, 166, 189);"></div></td></tr><tr><td aria-label="RGB (224, 102, 102)"><div title="RGB (224, 102, 102)" style="background-color: rgb(224, 102, 102);"></div></td><td aria-label="RGB (246, 178, 107)"><div title="RGB (246, 178, 107)" style="background-color: rgb(246, 178, 107);"></div></td><td aria-label="RGB (255, 217, 102)"><div title="RGB (255, 217, 102)" style="background-color: rgb(255, 217, 102);"></div></td><td aria-label="RGB (147, 196, 125)"><div title="RGB (147, 196, 125)" style="background-color: rgb(147, 196, 125);"></div></td><td aria-label="RGB (118, 165, 175)"><div title="RGB (118, 165, 175)" style="background-color: rgb(118, 165, 175);"></div></td><td aria-label="RGB (111, 168, 220)"><div title="RGB (111, 168, 220)" style="background-color: rgb(111, 168, 220);"></div></td><td aria-label="RGB (142, 124, 195)"><div title="RGB (142, 124, 195)" style="background-color: rgb(142, 124, 195);"></div></td><td aria-label="RGB (194, 123, 160)"><div title="RGB (194, 123, 160)" style="background-color: rgb(194, 123, 160);"></div></td></tr><tr><td id="T-Kw-Jn104" aria-label="RGB (204, 0, 0)"><div title="RGB (204, 0, 0)" style="background-color: rgb(204, 0, 0);"></div></td><td aria-label="RGB (230, 145, 56)"><div title="RGB (230, 145, 56)" style="background-color: rgb(230, 145, 56);"></div></td><td aria-label="RGB (241, 194, 50)"><div title="RGB (241, 194, 50)" style="background-color: rgb(241, 194, 50);"></div></td><td aria-label="RGB (106, 168, 79)"><div title="RGB (106, 168, 79)" style="background-color: rgb(106, 168, 79);"></div></td><td aria-label="RGB (69, 129, 142)"><div title="RGB (69, 129, 142)" style="background-color: rgb(69, 129, 142);"></div></td><td aria-label="RGB (61, 133, 198)"><div title="RGB (61, 133, 198)" style="background-color: rgb(61, 133, 198);"></div></td><td aria-label="RGB (103, 78, 167)"><div title="RGB (103, 78, 167)" style="background-color: rgb(103, 78, 167);"></div></td><td aria-label="RGB (166, 77, 121)"><div title="RGB (166, 77, 121)" style="background-color: rgb(166, 77, 121);"></div></td></tr><tr><td aria-label="RGB (153, 0, 0)"><div title="RGB (153, 0, 0)" style="background-color: rgb(153, 0, 0);"></div></td><td aria-label="RGB (180, 95, 6)"><div title="RGB (180, 95, 6)" style="background-color: rgb(180, 95, 6);"></div></td><td aria-label="RGB (191, 144, 0)"><div title="RGB (191, 144, 0)" style="background-color: rgb(191, 144, 0);"></div></td><td aria-label="RGB (56, 118, 29)"><div title="RGB (56, 118, 29)" style="background-color: rgb(56, 118, 29);"></div></td><td aria-label="RGB (19, 79, 92)"><div title="RGB (19, 79, 92)" style="background-color: rgb(19, 79, 92);"></div></td><td aria-label="RGB (11, 83, 148)"><div title="RGB (11, 83, 148)" style="background-color: rgb(11, 83, 148);"></div></td><td aria-label="RGB (53, 28, 117)"><div title="RGB (53, 28, 117)" style="background-color: rgb(53, 28, 117);"></div></td><td aria-label="RGB (116, 27, 71)"><div title="RGB (116, 27, 71)" style="background-color: rgb(116, 27, 71);"></div></td></tr><tr><td aria-label="RGB (102, 0, 0)"><div title="RGB (102, 0, 0)" style="background-color: rgb(102, 0, 0);"></div></td><td aria-label="RGB (120, 63, 4)"><div title="RGB (120, 63, 4)" style="background-color: rgb(120, 63, 4);"></div></td><td aria-label="RGB (127, 96, 0)"><div title="RGB (127, 96, 0)" style="background-color: rgb(127, 96, 0);"></div></td><td aria-label="RGB (39, 78, 19)"><div title="RGB (39, 78, 19)" style="background-color: rgb(39, 78, 19);"></div></td><td aria-label="RGB (12, 52, 61)"><div title="RGB (12, 52, 61)" style="background-color: rgb(12, 52, 61);"></div></td><td aria-label="RGB (7, 55, 99)"><div title="RGB (7, 55, 99)" style="background-color: rgb(7, 55, 99);"></div></td><td aria-label="RGB (32, 18, 77)"><div title="RGB (32, 18, 77)" style="background-color: rgb(32, 18, 77);"></div></td><td aria-label="RGB (76, 17, 48)"><div title="RGB (76, 17, 48)" style="background-color: rgb(76, 17, 48);"></div></td></tr></tbody></table></div></div>',touchMode:false,keyPressed:null,events:["change"]};d.extend(true,this,a);this.localization=this.defaultLocalization;return a;},createInstance:function(n){var b=this;b.textArea=b.host;var p=b.host.attr("contenteditable");b.host.addClass(b.toThemeProperty("jqx-widget"));if(p==true||p=="true"){b.inline=true;b.widget=b.host;b.editorDocument=document;b.selection=new e(b.editorDocument);var c=d("<div class='jqx-editor-toolbar-container' unselectable='on' aria-label='Formatting options' role='toolbar'><div class='jqx-editor-toolbar'></div>");c.insertBefore(b.host);b.toolbarContainer=c;b.toolbar=c.find(".jqx-editor-toolbar");b.editor=b.host;b.contentEditableElement=b.element;}else{var m=d("<div class='jqx-editor'><div class='jqx-editor-container'><div class='jqx-editor-toolbar-container' aria-label='Formatting options' role='toolbar'><div class='jqx-editor-toolbar'></div></div><div class='jqx-editor-content'><iframe  src='javascript:\"<html></html>\"' allowtransparency='true' frameborder='0'></iframe></div></div></div>");b.widget=m;b.widget[0].className=b.widget[0].className+" "+b.element.className;try{b.widget[0].style=b.element.style;}catch(o){}var l=d.trim(b.host.html())+"&#8203;";if(b.lineBreak=="default"||b.lineBreak=="div"){l="<div>"+l+"</div>";}else{if(b.lineBreak=="p"){l="<p>"+l+"</p>";}}l=l.replace(/&lt;/ig,"<");l=l.replace(/&gt;/ig,">");b.host.css("display","none");b.host.after(m);m.find("iframe").after(b.host);b.container=m.find(".jqx-editor-container");b.toolbarContainer=m.find(".jqx-editor-toolbar-container");b.toolbar=m.find(".jqx-editor-toolbar");b.iframe=m.find("iframe");b.content=m.find(".jqx-editor-content");var a=function(){b.editorDocument=b.iframe[0].contentWindow.document;b.selection=new e(b.editorDocument);var j=0;b.addHandler(b.iframe,"load",function(){j++;if(j>1){b.iframe.off("load");b.content.find("iframe").remove();var r=d("<iframe  src='javascript:\"<html></html>\"' allowtransparency='true' frameborder='0'></iframe>").appendTo(b.content);b.iframe=m.find("iframe");a();}});if(!d.jqx.browser.mozilla){b.editorDocument.designMode="On";}b.editorDocument.open();var g=b.rtl?"direction:rtl;":"";var h=d.jqx.browser.msie?"::selection{color: #fff; background: #328EFD;};::-moz-selection{color: #fff; background: #328eD;};::selection:window-inactive {background: #c7c7c7; color: #000;}::-moz-selection:window-inactive {background: #c7c7c7; color: #000;}html{font-size:13px; height:100%;}body{padding-top:1px;margin-top:-1px; padding-right: 1px; overflow-x: hidden;word-wrap: break-word;-webkit-nbsp-mode: space;-webkit-line-break: after-white-space;":"";b.editorDocument.write("<!DOCTYPE html><html><head><meta charset='utf-8' /><style>html,body{padding:0; margin:0; font-size: 13px; font-family:Verdana,Geneva,sans-serif; background:#fff; min-height:100%; "+g+"}"+h+"}h1{font-size:2em;margin:.67em 0}h2{font-size: 1.5em; margin: .75em 0}h3{font-size: 1.17em; margin: .83em 0}h4{font-size:1em; margin: 1.12em 0 }h5{font-size: .83em; margin: 1.5em 0}h6{font-size: .75em; margin: 1.67em 0}p{margin: 0px;padding:0 .2em}ul,ol{padding-left:2.5em}a{color:#00a}code{font-size:1.23em}.jqx-editor-paste-element {position: absolute; left: -1000px; height: 1px; overflow: hidden; top: -1000px;}.jqx-editor-focus {border: 1px solid #aaa !important;}</style>"+d.map(b.stylesheets,function(r){return"<link rel='stylesheet' href='"+r+"'>";}).join("")+"</head><body autocorrect='off' contenteditable='true'></body></html>");b.contentEditableElement=b.editorDocument.body;if(b.host.is("textarea")){b._textArea=b.element;var k=b.host.data();k.jqxEditor.host=m;k.jqxEditor.element=m[0];b.element=m[0];m[0].id=b._textArea.id;b._textArea.id=b._textArea.id+"TextArea";d(b.element).addClass(b.toThemeProperty("jqx-widget"));b.host=d(b.element);b.host.data(k);}else{var k=b.host.data();k.jqxEditor.host=m;k.jqxEditor.element=m[0];b.element=m[0];b.host=d(b.element);b.host.data(k);}try{b.editorDocument.execCommand("useCSS",false,false);b.editorDocument.execCommand("enableInlineTableEditing",null,false);}catch(i){}try{b.editorDocument.execCommand("styleWithCSS",0,true);}catch(i){}b.editorDocument.close();b.editor=d(b.editorDocument.body);b.editor.html(l).attr("spellcheck",false).attr("autocorrect","off");};a();d.jqx.utilities.resize(b.host,function(){b.widget.css("width",b.width);b.widget.css("height",b.height);b._arrange();});}},focus:function(){var a=this;if(d.jqx.browser.mozilla){if(!a.focused){if(a.iframe){a.iframe.focus();}a.selection.selectNode(a.editor[0].firstChild,true);a.selection.getRange().collapse(true);}}a.editor.focus();var b=a.range!=null?a.range:a.getRange();a.selectRange(b);},print:function(){var a=window.open("","_blank","width=450,height=470,left=400,top=100,menubar=yes,toolbar=no,location=no,scrollbars=yes");a.document.open();a.document.write('<!doctype html><html><head><title>Print</title></head><body onload="print();">'+this.val()+"</body></html>");a.document.close();},refresh:function(z){var r=this;d.each(this.defaultLocalization,function(g,h){if(!r.localization[g]){r.localization[g]=h;}});r._removeHandlers();r.toolbar.addClass(r.toThemeProperty("jqx-widget-header"));if(r.content){r.widget.css("width",r.width);r.widget.css("height",r.height);r.widget.addClass(r.toThemeProperty("jqx-editor"));r.widget.addClass(r.toThemeProperty("jqx-widget"));r.widget.addClass(r.toThemeProperty("jqx-rc-all"));r.widget.addClass(r.toThemeProperty("jqx-widget-header"));r.content.addClass(r.toThemeProperty("jqx-widget-content"));r.container.addClass(r.toThemeProperty("jqx-editor-container"));}else{r.toolbarContainer.addClass(r.toThemeProperty("jqx-widget-header"));r.toolbarContainer.addClass(r.toThemeProperty("jqx-editor-toolbar-inline"));r.toolbarContainer.addClass(r.toThemeProperty("jqx-widget"));r.toolbarContainer.addClass(r.toThemeProperty("jqx-rc-all"));r.toolbarContainer.hide();r.toolbarContainer.css("position","absolute");r.editor.addClass(r.toThemeProperty("jqx-editor-inline"));r.toolbarContainer.css("width",r.host.outerWidth()+"px");}var i=r.toolbarContainer.index();if(r.toolbarPosition=="top"&&i!=0||r.toolbarPosition=="bottom"&&i!=1){switch(r.toolbarPosition){case"bottom":r.toolbarContainer.insertAfter(r.content);break;case"top":default:r.toolbarContainer.insertBefore(r.content);break;}}var v=r.tools;if(v!==false){var s=v.split(" ");var b=v.split(" | ");var a=function(g,h){d.each(h,function(Q,X){var Y=r.commands[this];if(!Y){if(r.createCommand){Y=r.createCommand(this.toString());if(!Y){return true;}if(!r.commands[this]){r.commands[this]=Y;}}else{return true;}}else{if(r.createCommand){var S=r.createCommand(this.toString());Y=d.extend(Y,S);}}if(r.localization[this]){Y.tooltip=r.localization[this];}switch(Y.type){case"list":if(Y.widget){Y.widget.jqxDropDownList("destroy");}var af=function(B,C,A){if(Y.command=="formatblock"){return"<"+A+' unselectable="on" style="padding: 0px; margin: 0px;">'+C+"</"+A+">";}else{if(Y.command=="fontname"){return'<span unselectable="on" style="font-family: '+A+';">'+C+"<span>";}else{if(Y.command=="fontsize"){return'<span unselectable="on" style="font-size: '+A+';">'+C+"<span>";}}}};var aa=function(){var B=r.toThemeProperty("jqx-editor-toolbar-icon")+" "+r.toThemeProperty("jqx-editor-toolbar-icon-"+Y.command);var A="<div unselectable='on' style='margin-top: 0px; padding:0px;' class='"+B+"'></div>";return A;};var ad=Y.command=="formatblock"||Y.command=="fontname"||Y.command=="fontsize";var p=Y.value||[];var l=new Array();var q=Y.placeHolder||"Please Choose:";if(Y.command=="fontname"){d.each(p,function(){var A=r.localization[this.label];l.push({label:A,value:this.value});});}else{if(Y.command=="formatblock"){q=r.localization.format;d.each(p,function(){if(this.label.indexOf("Header")>=0){var A=this.label.replace("Header",r.localization.Header);}else{var A=r.localization[this.label];}l.push({label:A,value:this.value});});}else{l=p;}}var j={enableBrowserBoundsDetection:true,touchMode:r.touchMode,width:Y.width||100,height:Y.height||25,dropDownWidth:Y.dropDownWidth||"auto",autoDropDownHeight:(Y.value&&Y.value.length)<12?true:false,placeHolder:q,source:l,theme:r.theme,keyboardSelection:false,focusable:false,disabled:r.disabled,rtl:r.rtl,selectionRenderer:Y.command=="fontsize"?aa:null,renderer:ad?af:null};var ac="jqx-disableselect "+r.toThemeProperty("jqx-editor-dropdownlist")+" "+r.toThemeProperty("jqx-editor-toolbar-item");var U=d("<div unselectable='on' class='"+ac+"'></div>");U.appendTo(g);U.jqxDropDownList(j);if(Y.init){Y.init(U);}var X=null;var Z=null;var o="";r.addHandler(U,"mousedown",function(A){if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){var B=d(".jqx-editor-dropdownlist");d.each(B,function(D,C){if(C!=U[0]){d(C).jqxDropDownList("close");}});}});r.addHandler(U,"open",function(A){if(!r.focused){r.focus();}r.updating=true;r.activeElement=U;X=U.val();o="";});r.addHandler(U,"change",function(A){r.updating=false;r.activeElement=null;Z=U.val();o=A.args.type;if(d.jqx.browser.msie&&d.jqx.browser.version<9){r.focus();}});r.addHandler(U,"close",function(A){r.updating=false;r.activeElement=null;if(X!=Z){if(o=="mouse"||o=="keyboard"){r._refreshTools();}}});r._addCommandHandler(U,"change",Y.command,null,Y);break;case"colorPicker":if(Y.widget){d(Y.colorPicker).remove();Y.widget.jqxDropDownButton("destroy");}var ae=d('<div unselectable="on" style="padding-top: 4px;"></div>').attr("id","picker-"+Y.command);var ac="jqx-disableselect "+r.toThemeProperty("jqx-editor-dropdownpicker")+" "+r.toThemeProperty("jqx-editor-toolbar-item");var U=d("<div unselectable='on' class='"+ac+"'></div>");U.appendTo(g);U.append(ae);U.jqxDropDownButton({touchMode:r.touchMode,disabled:r.disabled,enableBrowserBoundsDetection:true,width:Y.width||45,height:Y.height||25,rtl:r.rtl,focusable:false,theme:r.theme});var R=d('<div unselectable="on" style="z-index: 55;">');var ab=r.toThemeProperty("jqx-editor-toolbar-icon")+" "+r.toThemeProperty("jqx-editor-toolbar-icon-"+Y.command);var k=d("<div unselectable='on' class='"+ab+"'></div>");R.append(k);var n=d('<div unselectable="on" class="jqx-editor-color-bar">').attr("id","bar-"+Y.command).css("background-color",Y.value);R.append(n);U.jqxDropDownButton("setContent",R);ae.append(d(r.colorPickerTemplate));Y.colorPicker=ae;if(Y.init){Y.init(U);}ae.find("tr").attr("role","row").attr("unselectable","on");ae.find("td").attr("role","gridcell").attr("unselectable","on").css("-webkit-user-select","none");ae.find("div").attr("unselectable","on");r.addHandler(U,"mousedown",function(A){if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}if(d(".jqx-editor-dropdownpicker").length>0){var B=d(".jqx-editor-dropdownpicker");d.each(B,function(D,C){if(C!=U[0]){d(C).jqxDropDownButton("close");}});}});r.addHandler(U,"open",function(){if(!r.focused){r.focus();}r.updating=true;r.activeElement=ae;});r.addHandler(U,"close",function(A){r.updating=false;r.activeElement=null;if(X!=Z){if(o=="mouse"||o=="keyboard"){r._refreshTools();}}});r.addHandler(ae,"keydown",function(K){var C=K.keyCode;var F=d(ae).find(".jqx-editor-color-picker-selected-cell");var A=ae.find("tr");var H=A.length;var I=F.parent().children().length;var G=F.index();var E=-999;var B=F.parent();d.each(A,function(M,L){if(this==B[0]){E=M;return false;}});switch(C){case 27:U.jqxDropDownButton("close");break;case 13:d(F).trigger("mousedown");break;case 38:E--;break;case 40:E++;break;case 39:G++;break;case 37:G--;break;}if(E>=0&&E<=H){if(G>=0&&G<=I){var B=ae.find("tr")[E];var D=d(B).children()[G];var J=d(D).children().css("background-color");Y.val(J);}}});var m=d(ae).find("td");Y.val=function(B){var A=r._rgbToHex(B);d.each(m,function(){var D=d(this).children().css("background-color");var C=r._rgbToHex(D);if(C==A){m.removeClass("jqx-editor-color-picker-selected-cell");d(this).addClass("jqx-editor-color-picker-selected-cell");d("#bar-"+Y.command).css("background",D);return false;}});};Y.val(Y.value);r._addCommandHandler(m,"mousedown",Y.command,null,Y);break;case"button":case"toggleButton":default:if(Y.widget){if(Y.type=="button"){Y.widget.jqxButton("destroy");}else{Y.widget.jqxToggleButton("destroy");}}var W=Y.command;var T=Y.action;var ab=r.toThemeProperty("jqx-editor-toolbar-icon")+" "+r.toThemeProperty("jqx-editor-toolbar-icon-"+W);var k=d("<div unselectable='on' class='"+ab+"'></div>");var U=d("<div unselectable='on'></div>").addClass("jqx-disableselect").addClass(r.toThemeProperty("jqx-editor-toolbar-button"));if(!Y.init){U.append(k);}else{if(W){U.append(k);}}U.appendTo(g);if(Y.type=="button"){U.jqxButton({disabled:r.disabled,rtl:r.rtl,theme:r.theme});}else{if(Y.type=="toggleButton"){U.jqxToggleButton({disabled:r.disabled,rtl:r.rtl,uiToggle:false,theme:r.theme});}}if(Y.init){Y.init(U);}Y.toggled=false;Y.toggle=function(){Y.toggled=!Y.toggled;};r.addHandler(U,"mousedown",function(A){if(A.preventDefault){A.preventDefault();}if(A.stopPropagation){A.stopPropagation();}return false;});if(!d.jqx.mobile.isTouchDevice()){r._addCommandHandler(U,"click",W,T,Y);}else{r._addCommandHandler(U,"mousedown",W,T,Y);}break;}Y.widget=U;if(U){try{if(Y.tooltip!=""){Y.widget.attr("title",Y.tooltip);Y.widget.attr("data-tooltip",Y.tooltip);}if(Y.command){Y.widget.attr("data-command",Y.command);}Y.widget.attr("aria-label",Y.tooltip);}catch(V){}if(Y.type=="button"||Y.type=="toggleButton"){if(h.length>2){if(Q==0){U.css("border-right-radius","0px");U.addClass(r.toThemeProperty("jqx-rc-l"));}else{if(Q==h.length-1){U.css("border-left-radius","0px");U.addClass(r.toThemeProperty("jqx-rc-r"));}}U.removeClass(r.toThemeProperty("jqx-rc-all"));}if(Q!=0&&Q!=h.length-1&&h.length>2){U.css("border-left-radius","0px");U.css("border-right-radius","0px");U.removeClass(r.toThemeProperty("jqx-rc-all"));}else{if(h.length==2){if(Q==0){U.css("border-right-radius","0px");U.addClass(r.toThemeProperty("jqx-rc-l"));}else{U.css("border-left-radius","0px");U.addClass(r.toThemeProperty("jqx-rc-r"));}U.removeClass(r.toThemeProperty("jqx-rc-all"));}else{if(h.length==1){U.css("margin-right","0px");}}}}}});};r.toolbar.css("direction",!this.rtl?"ltr":"rtl");if(b.length==0){a(r.toolbar,s);}else{for(var u=0;u<b.length;u++){var x=b[u];var s=x.split(" ");var c=r.toThemeProperty("jqx-editor-toolbar-group")+" "+r.toThemeProperty("jqx-fill-state-normal");var t=d("<div class='"+c+"'></div>");t.addClass(r.toThemeProperty("jqx-rc-all"));r.toolbar.append(t);a(t,s);}var w=r.toolbar.find(".jqx-editor-toolbar-group");var y=w.length;for(var u=0;u<y;u++){if(d(w[u]).children().length==0){d(w[u]).remove();}}}if(d.jqx.browser.msie&&d.jqx.browser.version<8){d(".jqx-editor-toolbar-group").css("float","left");d(".jqx-editor-toolbar-group").children().css("float","left");d(".jqx-editor-toolbar-group").css("zoom","1");d(".jqx-editor-toolbar-group").children().css("zoom","1");}}r._arrange();r._addHandlers();},_arrange:function(){var a=this;if(a.content){if(a.tools==""||a.tools==false){a.content.height(a.container.outerHeight()-parseInt(a.container.css("padding-top"))-parseInt(a.container.css("padding-bottom"))-6);a.content.css("margin-top","4px");a.toolbar.hide();}else{a.toolbar.show();a.content.css("margin-top","0px");a.content.height(a.container.outerHeight()-a.toolbar.outerHeight()-parseInt(a.container.css("padding-top"))-parseInt(a.container.css("padding-bottom"))-2);if(a.toolbarPosition!="top"){a.content.css("margin-top","4px");a.content.css("margin-bottom","0px");}}if(d.jqx.browser.msie&&d.jqx.browser.version<8){a.content.css("margin-top","4px");a.content.height(a.container.height()-a.toolbar.outerHeight()-2*parseInt(a.container.css("padding-bottom"))-10);a.content.width(a.container.width()-2*parseInt(a.container.css("padding-left"))-2);}if(a.editor.height()<a.content.height()){a.editor.height(a.content.height());}}},propertyChangedHandler:function(j,i,a,b){var c=j;if(c.isInitialized==undefined||c.isInitialized==false){return;}if(i=="pasteMode"||i=="lineBreak"||i=="editable"){return;}if(i=="disabled"){j._refreshTools();}if(i=="width"||i=="height"||i=="toolbarPosition"){j._arrange();return;}j.refresh();},selectRange:function(b){var a=this;if(!b){b=a.getRange();}a.selection.selectRange(b);},getRange:function(){var a=this;return a.selection.getRange();},getSelectedElement:function(){var n,b,r,o;var m=this;try{if(m.editorDocument.getSelection){var a=m.editorDocument.getSelection();n=a.getRangeAt(a.rangeCount-1);r=n.startContainer;o=n.endContainer;b=n.commonAncestorContainer;if(r.nodeName=="#text"){b=b.parentNode;}if(r.nodeName=="#text"){r=r.parentNode;}if(r.nodeName.toLowerCase()=="body"){r=r.firstChild;}if(o.nodeName=="#text"){o=o.parentNode;}if(o.nodeName.toLowerCase()=="body"){o=o.lastChild;}if(r==o){b=r;}return o;}else{if(m.editorDocument.selection){n=m.editorDocument.selection.createRange();if(!n.duplicate){return null;}b=n.parentElement();var p=n.duplicate();var q=n.duplicate();p.collapse(true);q.moveToElementText(p.parentElement());q.setEndPoint("EndToStart",p);r=p.parentElement();p=n.duplicate();q=n.duplicate();q.collapse(false);p.moveToElementText(q.parentElement());p.setEndPoint("StartToEnd",q);o=q.parentElement();if(r.nodeName.toLowerCase()=="body"){r=r.firstChild;}if(o.nodeName.toLowerCase()=="body"){o=o.lastChild;}if(r==o){b=r;}return o;}}}catch(c){return null;}return null;},_addHandlers:function(){var b=this;b.addHandler(b.toolbar,"mousedown.editor"+b.element.id,function(h){if(h.preventDefault){h.preventDefault();}if(h.stopPropagation){h.stopPropagation();}return false;});var a=function(){if(b._textArea){if(!b.updating){b._textArea.value=b.val();}}if(b.changed){b._raiseEvent("change");b.changed=false;}b.focused=false;if(b.inline){b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));b.host.removeClass(b.toThemeProperty("jqx-editor-inline-focus"));if(b.tools==""||b.tools==null){return;}b.toolbarContainer.fadeOut("fast");}};var c=function(){b.focused=true;if(b.inline){b.host.addClass(b.toThemeProperty("jqx-fill-state-focus"));b.host.addClass(b.toThemeProperty("jqx-editor-inline-focus"));b.host.addClass(b.toThemeProperty("jqx-rc-all"));if(b.tools==""||b.tools==null){return;}b.toolbarContainer.fadeIn("fast");var h=b.host.coord();if(b.toolbarPosition!="bottom"){b.toolbarContainer.offset({left:h.left,top:h.top-b.toolbarContainer.outerHeight()-5});}else{b.toolbarContainer.offset({left:h.left,top:h.top+5+b.host.height()});}}};if(d.jqx.browser.mozilla){this.addHandler(d(document),"mousedown.editor"+b.element.id,function(h){a();});}b.addHandler(b.editor,"blur.editor"+b.element.id,function(h){a();});b.addHandler(b.editor,"focus.editor"+b.element.id,function(h){c();});b.addHandler(b.editor,"beforedeactivate.editor"+b.element.id,function(h){b.range=b.getRange();});b.addHandler(b.editor,"mousedown.editor"+b.element.id,function(h){b.range=b.getRange();if(d.jqx.browser.mozilla){c();h.stopPropagation();}if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}if(b.inline){b.editor.focus();}});if(d.jqx.mobile.isTouchDevice()){b.addHandler(d(b.editorDocument),"selectionchange.editor"+b.element.id,function(){if(b.editorDocument.activeElement!=b.editor[0]){setTimeout(function(){if(b.iframe){b.iframe[0].contentWindow.focus();}},500);}});b.addHandler(d(b.editorDocument),"touchstart.editor"+b.element.id,function(){setTimeout(function(){if(b.iframe){b.iframe[0].contentWindow.focus();}},500);});}b.addHandler(b.editor,"mouseup.editor"+b.element.id,function(h){if(b._documentMode=="source"){return true;}b.range=b.getRange();b._refreshTools(null,true);});b.addHandler(b.editor,"keydown.editor"+b.element.id,function(D){if(b.keyPressed){b.keyPressed(D);}if(b._documentMode=="source"){return true;}if(d.jqx.browser.mozilla){if(!b.focused){c();}}if(b.disabled){if(D.preventDefault){D.preventDefault();}return false;}if(b.updating){if(b.activeElement){var x=d.Event("keydown");d.extend(x,D);b.activeElement.trigger(x);}if(D.preventDefault){D.preventDefault();}return false;}var w=D||window.event;var t=w.keyCode;var s=String.fromCharCode(t).toLowerCase();if(!b.editable){var y=[9,33,34,35,36,37,38,39,40,40,45];if(d.inArray(w.keyCode,y)==-1&&!(w.ctrlKey&&s=="c")&&!(w.ctrlKey&&s=="a")){D.preventDefault();}}if(b.selection.getText().length>0||b.linkPopup){var y=[8,9,13,33,34,35,36,37,38,39,40,40,45,46];if(!d.inArray(w.keyCode,y)!=-1||(w.keyCode==65&&w.ctrlKey&&!w.altKey&&!w.shiftKey)){if(b._refreshToolsTimer){clearTimeout(b._refreshToolsTimer);}b._refreshToolsTimer=setTimeout(function(){b._refreshTools(null,true,w.keyCode);},10);}}if(t==13&&b.lineBreak!="default"){var z=b.getSelectedElement();if(z){var v=z.nodeName.toLowerCase();switch(v){case"pre":case"li":case"ul":case"ol":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return true;}var u=z;while(u!=null){if(u.nodeName=="#document"){u=b.editorDocument.body;break;}if(u.parentNode==b.editorDocument.body||u==b.editorDocument.body){break;}u=u.parentNode;}}if(u){var A=b.getRange();if(b.editorDocument.body.innerHTML=="<div></div>"&&b.lineBreak!="br"){b.selection.insertContent("&#8203;");}if(b.lineBreak=="div"){if(u==b.editorDocument.body){d(u).append("<div>&#8203;</div><span id='INSERTION_MARKER'>&nbsp;</span>");}else{d("<div>&#8203;</div><span id='INSERTION_MARKER'>&nbsp;</span>").insertAfter(u);}}else{if(b.lineBreak=="p"){if(u==b.editorDocument.body){d(u).append("<p>&#8203;</p><span id='INSERTION_MARKER'>&nbsp;</span>");}else{d("<p>&#8203;</p><span id='INSERTION_MARKER'>&nbsp;</span>").insertAfter(u);}}else{b.execute("insertHTML","<br/>&#8203;<span id='INSERTION_MARKER'>&nbsp;</span>");}}b.selectRange(A);var B=d(b.editorDocument).find("#INSERTION_MARKER");if(b.lineBreak!="br"){b.selection.selectNode(d(B).prev()[0],true);}else{b.selection.selectNode(B[0],true);if(b.getRange().setStartAfter){b.getRange().setStartAfter(B[0]);}}B.remove();b.selection.collapse(false);if(u&&u.nodeName&&b.lineBreak=="br"){if(u.nodeName.toLowerCase()!="#text"){b.selection.selectNode(u,true);if(b.getRange().setStartAfter){b.getRange().setStartAfter(u);}b.selection.collapse(false);}}if(b.lineBreak!="br"){A=b.getRange();if(A.select){A.select();}}if(D.preventDefault){D.preventDefault();}return false;}}if(w.ctrlKey&&(s=="k"||s=="u"||s=="b"||s=="i")){if(D.preventDefault){D.preventDefault();}var C=null;switch(s){case"k":C="link";break;case"u":C="underline";break;case"b":C="bold";break;case"i":C="italic";break;}if(b.commands[C].widget){b.commands[C].widget.trigger("click");}return false;}});b.addHandler(b.editor,"paste.editor"+b.element.id,function(p){if(b._documentMode=="source"){return true;}if(b.readOnly){return true;}b.updating=true;b.readOnly=true;var o=p;var q=function(g,h){if(h){if(!b.paragraphise){g=g.replace(/\n/g,"<br />");}else{g="<p>"+g+"</p>";g=g.replace(/\n/g,"</p><p>");g=g.replace(/<p>\s<\/p>/gi,"");}}else{g=g.replace(/<html[^>]*?>(.*)/gim,"$1");g=g.replace(/<\/html>/gi,"");g=g.replace(/<body[^>]*?>(.*)/gi,"$1");g=g.replace(/<\/body>/gi,"");g=g.replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,"");g=g.replace(/<(?:meta|link)[^>]*>\s*/gi,"");g=g.replace(/<\\?\?xml[^>]*>/gi,"");g=g.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"");g=g.replace(/<o:p>\s*<\/o:p>/g,"");g=g.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;");g=g.replace(/<\/?\w+:[^>]*>/gi,"");g=g.replace(/<\!--[\s\S]*?-->/g,"");g=g.replace(/<\!\[[\s\S]*?\]>/g,"");g=g.replace(/\s*mso-[^:]+:[^;"']+;?/gi,"");g=g.replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3");g=g.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3");g=g.replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,"");g=g.replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"');g=g.replace(/\s*text-indent: 0cm\s*;/gi,"");g=g.replace(/\s*text-indent: 0cm\s*"/gi,'"');g=g.replace(/\s*text-align: [^\s;]+;?"/gi,'"');g=g.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"');g=g.replace(/\s*font-variant: [^\s;]+;?"/gi,'"');g=g.replace(/\s*tab-stops:[^;"']*;?/gi,"");g=g.replace(/\s*tab-stops:[^"']*/gi,"");g=g.replace(/\s*face="[^"']*"/gi,"");g=g.replace(/\s*face=[^ >]*/gi,"");g=g.replace(/\s*font-family:[^;"']*;?/gi,"");g=g.replace(/\s*font-size:[^;"']*;?/gi,"");g=g.replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3");g=g.replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/ig,"");g=g.replace(/\s*style='\s*'/gi,"");g=g.replace(/\s*style="\s*"/gi,"");g=g.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;");g=g.replace(/<span\s*[^>]*><\/span>/gi,"");g=g.replace(/<(\w[^>]*) align=([^ |>]*)([^>]*)/gi,"<$1$3");g=g.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3");g=g.replace(/<span([^>]*)>([\s\S]*?)<\/span>/gi,"$2");g=g.replace(/<font\s*>([\s\S]*?)<\/font>/gi,"$1");g=g.replace(/<(u|i|strike)>&nbsp;<\/\1>/gi,"&nbsp;");g=g.replace(/<h\d>\s*<\/h\d>/gi,"");g=g.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3");g=g.replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3");g=g.replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3");g=g.replace(/<h(\d)([^>]*)>/gi,"<h$1>");g=g.replace(/<(h\d)><font[^>]*>([\s\S]*?)<\/font><\/\1>/gi,"<$1>$2</$1>");g=g.replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>");g=g.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");g=g.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");g=g.replace(/<\s+[^>]*>/gi,"");g=g.replace(/<span>([\s\S]*?)<\/span>/gi,"$1");g=g.replace(/<span>([\s\S]*?)<\/span>/gi,"$1");g=g.replace(/<div>([\s\S]*?)<\/div>/gi,"$1");g=g.replace(/<div>([\s\S]*?)<\/div>/gi,"$1");g=g.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");g=g.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");g=g.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");if(g.trim){g=g.trim();}if(!b.paragraphise){g.replace(/<p>/gi,"<br />");g.replace(/<\/p>/gi,"");}else{var i=g.substr(0,2);if("<p"!==i){g="<p>"+g+"</p>";g=g.replace(/\n/g,"</p><p>");g=g.replace(/<br[^>]*>/gi,"</p><p>");}}g=g.replace(/<br>/gi,"<br />");g=g.replace(/<br[^>]*><\/p>/gim,"</p>");g=g.replace(/<p>&nbsp;<\/p>/gi,"");g=g.replace(/<p>\s<\/p>/gi,"");g=g.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");g=g.replace(/MsoNormal/gi,"");g=g.replace(/<\/?meta[^>]*>/gi,"");g=g.replace(/<\/?xml[^>]*>/gi,"");g=g.replace(/<\?xml[^>]*\/>/gi,"");g=g.replace(/<!--(.*)-->/gi,"");g=g.replace(/<!--(.*)>/gi,"");g=g.replace(/<!(.*)-->/gi,"");g=g.replace(/<w:[^>]*>(.*)<\/w:[^>]*>/gi,"");g=g.replace(/<w:[^>]*\/>/gi,"");g=g.replace(/<\/?w:[^>]*>/gi,"");g=g.replace(/<m:[^>]*\/>/gi,"");g=g.replace(/<m:[^>]>(.*)<\/m:[^>]*>/gi,"");g=g.replace(/<o:[^>]*>(.*)<\/o:[^>]*>/gi,"");g=g.replace(/<o:[^>]*\/>/gi,"");g=g.replace(/<\/?m:[^>]*>/gi,"");g=g.replace(/style=\"([^>]*)\"/gi,"");g=g.replace(/style=\'([^>]*)\'/gi,"");g=g.replace(/class=\"(.*)\"/gi,"");g=g.replace(/class=\'(.*)\'/gi,"");g=g.replace(/<b>/gi,"<strong>");g=g.replace(/<\/b>/gi,"</strong>");g=g.replace(/<p[^>]*>/gi,"<p>");g=g.replace(/<\/p[^>]*>/gi,"</p>");g=g.replace(/<span[^>]*>/gi,"");g=g.replace(/<\/span[^>]*>/gi,"");g=g.replace(/<st1:[^>]*>/gi,"");g=g.replace(/<\/st1:[^>]*>/gi,"");g=g.replace(/<font[^>]*>/gi,"");g=g.replace(/<\/font[^>]*>/gi,"");g=g.replace("  ","");g=g.replace(/<strong><\/strong>/gi,"");g=g.replace(/<p><\/p>/gi,"");g=g.replace(/\/\*(.*)\*\//gi,"");g=g.replace(/<!--/gi,"");g=g.replace(/-->/gi,"");g=g.replace(/<style[^>]*>[^<]*<\/style[^>]*>/gi,"");g=g.trim();}return g;};var v=b.getRange();if(b.pasteMode=="text"){b.selection.insertContent('<textarea cols="50" contenteditable="false" class="jqx-editor-paste-element"></textarea>');}else{b.selection.insertContent('<div class="jqx-editor-paste-element">&nbsp;</div>');}var u=d(window).scrollTop();var t=d(b.editorDocument).find(".jqx-editor-paste-element");t.css("top",u+"px");if(b.editor[0].createTextRange){p.preventDefault();var r=b.editor[0].createTextRange();r.moveToElementText(t[0]);r.execCommand("Paste");}else{var s=b.editorDocument.createRange();s.selectNodeContents(t[0]);b.selectRange(s);}if(b.pasteMode=="text"){t.select();}b.marker=t;setTimeout(function(){b.selectRange(v);var g=function(w){var B=b.editorDocument.createElement("div");var x=b.editorDocument.createDocumentFragment();B.innerHTML=w;while(B.firstChild){x.appendChild(B.firstChild);}return x;};if(b.pasteMode!="text"){var k=g(b.marker.html());if(k.firstChild&&k.firstChild.className==="jqx-editor-paste-element"){var i=[];for(var n=0,z=k.childNodes.length;n<z;n++){i.push(k.childNodes[n].innerHTML);}k=g(i.join("<br />"));}var j=document.createElement("div");j.appendChild(k.cloneNode(true));var l=j.innerHTML;}else{var l=b.marker.val();if(b.marker.html()!=""&&b.marker.val().indexOf("\n")==-1){var l=b.marker.html();l=l.replace(/&nbsp;/gm,"");l=l.replace(/\n\n/gm,"\n");l=l.replace(/<br[^>]*>/gi,"\n");b.marker.html(l);var l=b.marker.text();}}var h=q(l,b.pasteMode=="text");var m=b.getRange();b.selection.insertContent(h+"<span id='INSERTION_MARKER'>&nbsp;</span>");b.marker.remove();var y=d(b.editorDocument).find("#INSERTION_MARKER");b.selection.selectNode(y[0],true);if(b.getRange().setStartAfter){b.getRange().setStartAfter(y[0]);}y.remove();b.selection.collapse(false);y.removeAttr("id");b._refreshTools();b.changed=true;},100);b.updating=false;b.readOnly=false;});b.addHandler(b.editor,"keyup.editor"+b.element.id,function(l){if(b._documentMode=="source"){return true;}if(b.updating||b.disabled||!b.editable){if(l.preventDefault){l.preventDefault();}if(l.stopPropagation){l.stopPropagation();}return false;}b.range=b.getRange();b.changed=true;var m=l||window.event;var n=m.keyCode;var k=[8,9,13,33,34,35,36,37,38,39,40,40,45,46];if(d.inArray(m.keyCode,k)!=-1||(m.keyCode==65&&m.ctrlKey&&!m.altKey&&!m.shiftKey)){b._refreshTools(null,true,m.keyCode);}});b.addHandler(b.editor,"click.editor"+b.element.id,function(j){if(b._documentMode=="source"){return true;}if(b.editImage){d(b.editImage).removeClass("jqx-editor-focus");b.editImage=null;}if(j.target.tagName.toLowerCase()=="img"){var i=j.target;b.editImage=i;d(b.editImage).addClass("jqx-editor-focus");}});b.addHandler(b.editor,"dblclick.editor"+b.element.id,function(j){if(b._documentMode=="source"){return true;}if(j.target.tagName.toLowerCase()=="img"){var i=j.target;if(d(".jqx-editor-image-window").length>0){b.editImage=i;b._updateImageWindow();}}});},_updateLinkWindow:function(){var k=this;var b=d(".jqx-editor-link-window");b.jqxWindow({position:{center:k.widget}});b.jqxWindow("open");var m=b.find("input");var c=b.find(".jqx-editor-link-checkbox");var l=b.find("button:first");var n=d(b.find("button")[1]);if(k.editLink&&k.editLink.href){m[0].value=k.editLink.href||"";m[1].value=d(k.editLink).text()||k.editLink.href;c.val(d(k.editLink).attr("target")=="_blank");n.show();}else{m[0].value="";m[1].value="";if(!k.selection.isCollapsed()){var a=k.selection.getText();if(a.match(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/i)){m[0].value=a;}else{m[1].value=a;}}c.val(false);n.hide();}if(m[0].value.length>0){l.jqxButton({disabled:false});}else{l.jqxButton({disabled:true});}},_updateImageWindow:function(){var k=this;var b=k.editImage;if(!b){b=d("<img>")[0];}var c=d(".jqx-editor-image-window");c.jqxWindow({position:{center:k.widget}});c.jqxWindow("open");var m=c.find("input");var n=d(c.find("button")[1]);if(k.editImage){n.show();}else{n.hide();}m[0].value=b.src;if(m[0].value==""){m[0].value="";}m[1].value=b.alt;if(b.style.width!="auto"){m[2].value=b.style.width;}else{m[2].value="";}if(b.style.height!="auto"){m[3].value=b.style.height;}else{m[3].value="";}if(b.style.marginLeft&&b.style.marginLeft!="0px"){m[4].value=b.style.marginLeft;}else{m[4].value="";}if(b.style.marginTop&&b.style.marginTop!="0px"){m[5].value=b.style.marginTop;}else{m[5].value="";}var a=c.find(".jqx-editor-align");var l=d(b).css("float");if(l=="left"){a.jqxDropDownList({selectedIndex:1});}else{if(l=="right"){a.jqxDropDownList({selectedIndex:2});}else{a.jqxDropDownList({selectedIndex:0});}}},_removeHandlers:function(){var a=this;if(a.editor){a.removeHandler(a.editor,"blur.editor"+a.element.id);a.removeHandler(a.editor,"focus.editor"+a.element.id);a.removeHandler(a.editor,"click.editor"+a.element.id);a.removeHandler(a.editor,"mousedown.editor"+a.element.id);a.removeHandler(a.editor,"mouseup.editor"+a.element.id);a.removeHandler(a.editor,"keyup.editor"+a.element.id);a.removeHandler(a.editor,"keydown.editor"+a.element.id);a.removeHandler(a.editor,"beforedeactivate.editor"+a.element.id);a.removeHandler(a.editor,"dblclick.editor"+a.element.id);}if(a.toolbar){a.removeHandler(a.toolbar,"mousedown.editor"+a.element.id);}},getParentByTag:function(b,c){var c=c.toLowerCase(),a=b;do{if(c==""||a.nodeName.toLowerCase()==c){return a;}}while(a=a.parentNode);return b;},isStyleProperty:function(k,l,a,b){var l=l.toLowerCase(),c=k;do{if(c.nodeName.toLowerCase()==l&&c.style[a]==b){return !0;}}while(c=c.parentNode);return !1;},setStyleProperty:function(b,c){this.style[c]=!1;var a=this.getParentByTag(b,c);a&&a.tagName.toLowerCase()==c&&(this.style[c]=!0);if(c=="del"&&this.getParentByTag(b,"strike")&&this.getParentByTag(b,"strike").tagName.toLowerCase()=="strike"){this.style.del=!0;}},updateStyle:function(l){var k=this;var l=k.getSelectedElement()?k.getSelectedElement():l;if(!l||!k.setStyleProperty){return;}try{if(window.getComputedStyle){if(l.nodeName.toLowerCase()=="#text"){l=k.editor[0];}var m=window.getComputedStyle(l,null);var b=((m.getPropertyValue("font-weight")==401)?700:m.getPropertyValue("font-weight"));k.style={fontStyle:m.getPropertyValue("font-style"),fontSize:m.getPropertyValue("font-size"),textDecoration:m.getPropertyValue("text-decoration"),fontWeight:b,fontFamily:m.getPropertyValue("font-family"),textAlign:m.getPropertyValue("text-align"),color:k._rgbToHex(m.color),backColor:k._rgbToHex(m.backgroundColor)};k.style.fontStyle=m.getPropertyValue("font-style");k.style.vAlign=m.getPropertyValue("vertical-align");k.style.del=k.isStyleProperty(l,"span","textDecoration","line-through");k.style.u=k.isStyleProperty(l,"span","textDecoration","underline");var c=function(g){var h="transparent";var i="rgba(0, 0, 0, 0)";while(g&&(window.getComputedStyle(g).backgroundColor==h||window.getComputedStyle(g).backgroundColor==i)){g=g.parentNode;}return g?window.getComputedStyle(g).backgroundColor:h;};if(!k.style.backColor){k.style.backColor=k._rgbToHex(c(l));}}else{var m=l.currentStyle;k.style={fontStyle:m.fontStyle,fontSize:m.fontSize,textDecoration:m.textDecoration,fontWeight:m.fontWeight,fontFamily:m.fontFamily,textAlign:m.textAlign,color:k._rgbToHex(m.color),backColor:k._rgbToHex(m.backgroundColor)};}k.setStyleProperty(l,"h1");k.setStyleProperty(l,"h2");k.setStyleProperty(l,"h3");k.setStyleProperty(l,"h4");k.setStyleProperty(l,"h5");k.setStyleProperty(l,"h6");k.setStyleProperty(l,"del");k.setStyleProperty(l,"sub");k.setStyleProperty(l,"sup");k.setStyleProperty(l,"u");if(l.nodeName.toLowerCase()=="a"){if(k.style.textDecoration=="underline"){k.style.u=true;}}if(k.style.h1||k.style.h2||k.style.h3||k.style.h4||k.style.h5||k.style.h6){k.style.heading=true;}}catch(a){return null;}},_refreshTools:function(u,t,b){var p=this;if(p.updating){return;}var u=p.getSelectedElement()?p.getSelectedElement():u;if(!u||!p.setStyleProperty){return;}p.updateStyle(u);var a=p.readOnly;p.readOnly=true;if(p.tools!==false){var q=p.tools.split(" ");var i=p.tools.split(" | ");var c=function(g){d.each(g,function(j,h){var k=p.commands[this];if(!k){return true;}switch(k.type){case"list":k.widget.jqxDropDownList("clearSelection");k.widget.jqxDropDownList({disabled:p.disabled});break;case"colorPicker":k.val(k.value);k.widget.jqxDropDownButton({disabled:p.disabled});break;case"toggleButton":k.widget.jqxToggleButton("unCheck");k.widget.jqxToggleButton({disabled:p.disabled});break;case"button":default:k.widget.jqxButton({disabled:p.disabled});break;}});};if(i.length==0){c(q);}else{for(var r=0;r<i.length;r++){var v=i[r];var q=v.split(" ");c(q);}}if(p.style){var s=function(g){d.each(g,function(l,M){var N=p.commands[this];if(!N){return true;}if(N.refresh){N.refresh(N.widget,p.style);return true;}switch(N.type){case"list":if(N.command=="fontname"){var S=-1;var P=999;for(var m=0;m<N.value.length;m++){var M=N.value[m].label.toLowerCase();var n=p.style.fontFamily.toLowerCase().indexOf(M);if(n>=0){if(n<P){S=m;}P=Math.min(P,n);}}N.widget.jqxDropDownList("selectIndex",S);}else{if(N.command=="formatblock"){var M=null;if(p.style.h1){M="h1";}else{if(p.style.h2){M="h2";}else{if(p.style.h3){M="h3";}else{if(p.style.h4){M="h4";}else{if(p.style.h5){M="h5";}else{if(p.style.h6){M="h6";}}}}}}N.widget.jqxDropDownList("selectItem",M);}else{if(N.command=="fontsize"){var U="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");var Q=-1;try{var Q=u.getAttribute("size")-1;if(Q==-1){Q=p.editorDocument.queryCommandValue(N.command)-1;}}catch(k){}var O=U[Q];N.widget.val(O);}}}break;case"colorPicker":var R=function(w){if(typeof w!="number"){return w;}return"rgb("+(w&255)+", "+((w&65280)>>8)+", "+((w&16711680)>>16)+")";};var L=R(p.editorDocument.queryCommandValue(N.command));if(N.command=="backcolor"){if(p.style.backColor==null){L="#FFFFFF";}}var h=p._rgbToHex(L);if(h){N.val(h);}else{if(N.command=="forecolor"){N.val(p.style.color);}else{if(N.command=="backcolor"){N.val(p.style.backColor);}}}break;case"toggleButton":if(N.command=="viewsource"){return;}if(!N.command){return;}var T=false;var V=p.editorDocument.queryCommandState(N.command)&&p.editorDocument.queryCommandEnabled(N.command);if(N.command=="createlink"&&u.nodeName.toLowerCase()=="a"){var j=true;if(d(u).text().indexOf(p.selection.getText())==-1&&p.selection.getText()!=""){j=false;}if(j){if(p.linkPopup){p.linkPopup.remove();}V=true;p.linkPopup=d("<div class='jqx-editor-link-popup' contentEditable='false' style='overflow: hidden; white-space: nowrap; padding: 5px; height: 17px; font-size: 12px; color: #222222; background: #F5F5F5; position: absolute; z-index: 9999;'>"+p.localization["Go to link"]+": <a target='_blank' style='color:#222222;' href='"+u.href+"'>"+u.href+"</a> - <a style='color:#222222;' href='#change'>"+p.localization.Change+"</a> - <a style='color:#222222;' href='#remove'>"+p.localization.Remove+"</a></div>").appendTo(p.editor);var K=d(u).coord();var J=K.left;if(K.left+p.linkPopup.width()>p.editor.width()){J=p.editor.width()-p.linkPopup.width()-15;}p.linkPopup.offset({top:d(u).height()+K.top+5,left:J});p.addHandler(p.linkPopup,"mousedown",function(x){if(x.target&&x.target.href){var y=d(x.target).index();switch(y){case 1:p.editor.focus();p.selection.selectNode(u,true);p.commands.link.widget.trigger("click");break;case 2:try{p.editor.focus();p.selection.selectNode(u);p.execute("unlink");p.commands.underline.toggled=false;p.selection.collapse(false);p._refreshTools();}catch(w){}break;default:window.open(x.target.href,"_blank");break;}}if(x.preventDefault){x.preventDefault();}if(x.stopPropagation){x.stopPropagation();}return false;});}}if(N.command=="bold"){if(p.style.fontWeight&&(p.style.fontWeight>=600||p.style.fontWeight=="bold")){T=true;}if(p.selection.isCollapsed()){N.toggled=V;}else{N.toggled=V||T;}V=N.toggled;}else{if(N.command=="italic"){if(p.style.fontStyle&&p.style.fontStyle=="italic"){T=true;}if(!t){V=N.toggled;}else{N.toggled=V;}}else{if(N.command=="underline"){if(p.style.u){T=true;}if(!t){V=N.toggled;}else{N.toggled=V;}}else{if(N.command=="justifyleft"){if(p.style.textAlign=="left"){T=true;}}else{if(N.command=="justifyright"){if(p.style.textAlign=="right"){T=true;}}else{if(N.command=="justifycenter"){if(p.style.textAlign=="center"){T=true;}}else{if(N.command=="justifyfull"){if(p.style.textAlign=="justify"){T=true;}}else{d.each(p.style,function(x,w){if(N.command==x.toLowerCase()){T=true;}});}}}}}}}var o=V;if(T&&N.command.indexOf("justify")!=-1){N.widget.jqxToggleButton("check");}else{if(o){N.widget.jqxToggleButton("check");}else{if(T&&p.range.collapsed===false){N.widget.jqxToggleButton("check");}else{if(d.jqx.browser.msie&&d.jqx.browser.version<9&&T&&!p.selection.isCollapsed()){N.widget.jqxToggleButton("check");}}}}break;case"button":default:if(N.refresh){N.refresh(N.widget,p.style);}break;}});};if(i.length==0){s(q);}else{for(var r=0;r<i.length;r++){var v=i[r];var q=v.split(" ");s(q);}}}}p.readOnly=a;},_rgbToHex:function(g){if(g){if(g.substr(0,1)==="#"){if(g.length==4){var b=g.substr(1,1);var c=g.substr(2,1);var j=g.substr(3,1);return"#"+b+b+c+c+j+j;}return g;}var a=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(g);if(!a){return null;}var b=parseInt(a[2],10).toString(16);var c=parseInt(a[3],10).toString(16);var j=parseInt(a[4],10).toString(16);return"#"+((b.length==1?"0"+b:b)+(c.length==1?"0"+c:c)+(j.length==1?"0"+j:j));}return null;},_preventDefault:function(b,a){if(a!==false){if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}}if(b.preventDefault){b.preventDefault();}if(b.stopPropagation){b.stopPropagation();}b.cancelBubble=true;b.returnValue=false;},_addCommandHandler:function(c,j,a,b,l){var k=this;if(!a&&l.init){a="custom";}switch(a){case"custom":switch(l.type){case"list":action=function(g){if(k._documentMode!="source"){if(g.args.type!="none"){l.value=d(this).val();k.execute("custom",l);if(!k.readOnly){k._refreshTools();}}}k._preventDefault(g,false);};break;case"colorPicker":action=function(g){if(k._documentMode!="source"){var i=d(l.colorPicker).find("td").removeClass("jqx-editor-color-picker-selected-cell");if(g.target.nodeName.toLowerCase()=="div"){var h=d(g.target).css("background-color");d(g.target).parent().addClass("jqx-editor-color-picker-selected-cell");}else{var h=d(g.target).find("div").css("background-color");d(g.target).addClass("jqx-editor-color-picker-selected-cell");}d("#bar-"+a).css("background",h);l.widget.val=function(){var r=function(m){if(typeof m!="number"){return m;}return"rgb("+(m&255)+", "+((m&65280)>>8)+", "+((m&16711680)>>16)+")";};var q=r(h);var p=k._rgbToHex(q);return p;};l.widget.jqxDropDownButton("close");k.execute("custom",l);}k._preventDefault(g);return false;};break;case"button":case"toggleButton":default:action=function(i){if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}k._preventDefault(i);var g=d(this).attr("data-command");var h=this;if(k._documentMode!="source"){if(l.toggle){l.toggle();}k.execute("custom",l);k._refreshTools();}return false;};break;}break;case"formatblock":action=function(g){if(k._documentMode!="source"){if(g.args.type!="none"){k.execute(d(this).attr("data-command"),"<"+d(this).val()+">",l);if(!k.readOnly){k.commands.bold.toggled=false;k._refreshTools();}}}k._preventDefault(g,false);};break;case"fontsize":action=function(n){if(k._documentMode!="source"){if(n.args.type!="none"){var h=d(this).val();var g="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");var i=d(this).jqxDropDownList("getSelectedIndex")+1;var i=1+g.indexOf(h);k.execute(d(this).attr("data-command"),i,l);}}k._preventDefault(n,false);};break;case"fontname":action=function(h){if(k._documentMode!="source"){if(h.args.type!="none"){var g=d(this).val();k.execute(d(this).attr("data-command"),g,l);}}k._preventDefault(h,false);};break;case"forecolor":case"backcolor":action=function(g){if(k._documentMode!="source"){var i=d(l.colorPicker).find("td").removeClass("jqx-editor-color-picker-selected-cell");if(g.target.nodeName.toLowerCase()=="div"){var h=d(g.target).css("background-color");d(g.target).parent().addClass("jqx-editor-color-picker-selected-cell");}else{var h=d(g.target).find("div").css("background-color");d(g.target).addClass("jqx-editor-color-picker-selected-cell");}d("#bar-"+a).css("background",h);l.widget.jqxDropDownButton("close");k.execute(a,h,l);}k._preventDefault(g);return false;};break;case"viewsource":action=function(g){if(k.linkPopup){k.linkPopup.remove();}l.toggle();k.setMode(l.toggled);if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}k._preventDefault(g);return false;};break;case"insertimage":action=function(g){k._insertImageAction(g,k,l);};break;case"createlink":action=function(g){k._createLinkAction(g,k,l);};break;default:action=function(n){if(d(".jqx-editor-dropdownpicker").length>0){d(".jqx-editor-dropdownpicker").jqxDropDownButton("close");}if(d(".jqx-editor-dropdownlist").length>0){d(".jqx-editor-dropdownlist").jqxDropDownList("close");}k._preventDefault(n);var g=d(this).attr("data-command");var i=this;if(k._documentMode!="source"){if(g=="underline"){if(k.getSelectedElement()){var h=k.getSelectedElement();if(h&&h.nodeName.toLowerCase()=="a"){if(l.toggled){d(h).css("text-decoration","none");}else{d(h).css("text-decoration","underline");}l.toggle();k._refreshTools();return false;}}}if(l.toggle){l.toggle();}k.execute(g,d(this).val(),l);k._refreshTools();}return false;};break;}k.addHandler(c,j,action);return false;},_createLinkAction:function(x,q,p){var q=this;if(q._documentMode=="source"){q._preventDefault(x);return;}if(!q.focused){q.editor.focus();}q.range=q.getRange();var w=q.getSelectedElement();if(w.nodeName.toLowerCase()=="a"){q.editLink=w;}else{q.editLink=null;}if(d(".jqx-editor-link-window").length>0){if(q.editLink){q.selection.selectNode(w,true);}q._updateLinkWindow();q._preventDefault(x);return false;}var c=d("<div class='jqx-editor-window jqx-editor-link-window'><div>"+q.localization["Insert Link"]+"</div><div><table style='border-collapse: separate; border-spacing: 2px;'><tr><td align='right'>"+q.localization.URL+":</td><td><input style='width: 200px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+q.localization.Title+":</td><td><input style='width: 200px; height: 23px;' value=''/></td><tr/><tr><td align='right'></td><td><div class='jqx-editor-link-checkbox'>"+q.localization["Open in a new window/tab"]+"</div></td><tr/><tr><td align='right'></td><td align='right'><button>Ok</button><button style='margin-left: 5px;'>Remove</button><button style='margin-left: 5px;'>Cancel</button></td><tr/></table></div></div>");c[0].id="linkWindow"+this.element.id;var r=c.find("input");r.addClass(q.toThemeProperty("jqx-widget"));r.addClass(q.toThemeProperty("jqx-widget-content"));r.addClass(q.toThemeProperty("jqx-input"));var s=c.find(".jqx-editor-link-checkbox").jqxCheckBox({theme:q.theme,height:23,width:180});var u=c.find("button:first").jqxButton({theme:q.theme,disabled:true});var a=d(c.find("button")[1]).jqxButton({theme:q.theme});var t=c.find("button:last").jqxButton({theme:q.theme});u.val(q.localization.Ok);t.val(q.localization.Cancel);a.val(q.localization.Remove);q.addHandler(t,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(g){q.editor.focus();q.selectRange(q.range);q._refreshTools();q._preventDefault(g);});if(!q.editLink||(q.editLink&&!q.editLink.href)){a.hide();}var v=false;q.addHandler(d(r[0]),"focus",function(){if(r[1].value==""||r[1].value==r[0].value){v=true;}else{v=false;}});q.addHandler(d(r[1]),"keyup",function(g){if(g.keyCode){if(g.keyCode==13){u.trigger("click");}if(g.keyCode==27){t.trigger("click");}}});q.addHandler(d(r[0]),"keyup change",function(g){if(r[0].value.length>0){u.jqxButton({disabled:false});}else{u.jqxButton({disabled:true});}if(v){r[1].value=r[0].value;}if(g.keyCode){if(g.keyCode==13){u.trigger("click");}if(g.keyCode==27){t.trigger("click");}}});q.addHandler(a,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(h){c.jqxWindow("close");try{q.editor.focus();q.selection.selectNode(q.editLink);q.execute("unlink");q.selection.collapse(false);q.commands.underline.toggled=false;q._refreshTools();}catch(g){}q._preventDefault(h);});q.addHandler(u,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(g){var i=c.find("input");var h=d("<a>"+(i[1].value||i[0].value)+"</a>");if(s.val()){h.attr("target","_blank");}h[0].href=d.trim(i[0].value);if(i[0].value.indexOf("http")==-1&&i[0].value.indexOf("mailto")==-1){h[0].href="http://"+d.trim(i[0].value);}if(!q.focused){q.editor.focus();}if(q.range){q.selectRange(q.range);}if(q.editLink){d(q.editLink).remove();}q.execute("insertHTML",""+h[0].outerHTML+"<span id='INSERTION_MARKER'>&nbsp;</span>",p);q.editor.focus();var j=d(q.editorDocument).find("#INSERTION_MARKER");q.selection.selectNode(j[0],true);if(q.getRange().setStartAfter){q.getRange().setStartAfter(j[0]);}j.remove();q.selection.collapse(false);q._refreshTools();q._preventDefault(g);});q.updating=true;c.appendTo(document.body);q.addHandler(c,"open",function(){q.updating=true;setTimeout(function(){q.range=q.getRange();d(r[0]).focus();},25);});c.jqxWindow({resizable:false,width:280,okButton:u,cancelButton:t,theme:q.theme,isModal:true,position:{center:q.widget}});q.addHandler(c,"close",function(){q.updating=false;});if(!q.focused){q.editor.focus();q.selectRange(q.range);}if(q.editLink){r[0].value=q.editLink.href||"";r[1].value=d(q.editLink).text();s.val(d(q.editLink).attr("target")=="_blank");}else{if(!q.selection.isCollapsed()){var b=q.selection.getText();if(b.match(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/i)){r[0].value=b;}else{r[1].value=b;}}}if(r[0].value.length>0){u.jqxButton({disabled:false});}else{u.jqxButton({disabled:true});}q._preventDefault(x);return false;},_insertImageAction:function(b,c,m){if(c._documentMode=="source"){c._preventDefault(b);return;}if(!c.focused){c.editor.focus();}c.range=c.getRange();if(d(".jqx-editor-image-window").length>0){c._updateImageWindow();c._preventDefault(b);return false;}var l=d("<div class='jqx-editor-window jqx-editor-image-window'><div>"+c.localization["Insert Image"]+"</div><div><table style='border-collapse: separate; border-spacing: 2px;'><tr><td align='right'>"+c.localization.URL+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+c.localization["Alt Text"]+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+c.localization.Width+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+c.localization.Height+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+c.localization.HSpace+":</td><td><input style='width: 180px; height: 23px;' class='jqx-editor-hspace'/></td><tr/><tr><td align='right'>"+c.localization.VSpace+":</td><td><input style='width: 180px; height: 23px;' class='jqx-editor-vspace'/></td><tr/><tr><td align='right'>"+c.localization.Align+":</td><td><div class='jqx-editor-align'></div></td><tr/><tr><td align='right'></td><td align='right'><button>Ok</button><button style='margin-left: 5px;'>Remove</button><button style='margin-left: 5px;'>Cancel</button></td><tr/></table></div></div>");l[0].id="imageWindow"+this.element.id;var o=l.find("input");o.addClass(c.toThemeProperty("jqx-widget"));o.addClass(c.toThemeProperty("jqx-widget-content"));o.addClass(c.toThemeProperty("jqx-input"));l.find(".jqx-editor-align").jqxDropDownList({autoDropDownHeight:true,selectedIndex:0,theme:c.theme,height:23,width:180,source:[c.localization["not set"],c.localization.Left,c.localization.Right]});var n=l.find("button:first").jqxButton({theme:c.theme});var a=l.find("button:last").jqxButton({theme:c.theme});var p=d(l.find("button")[1]).jqxButton({theme:c.theme});n.val(c.localization.Ok);a.val(c.localization.Cancel);p.val(c.localization.Remove);p.hide();c.addHandler(p,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(g){d(c.editImage).removeClass("jqx-editor-focus");d(c.editImage).remove();c.editImage=null;c._preventDefault(g);l.jqxWindow("close");c._raiseEvent("change");});c.addHandler(a,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(g){d(c.editImage).removeClass("jqx-editor-focus");c.editImage=null;c._preventDefault(g);});c.addHandler(n,!d.jqx.mobile.isTouchDevice()?"click":d.jqx.mobile.getTouchEventName("touchstart"),function(k){d(c.editImage).removeClass("jqx-editor-focus");var g=l.find("input");var j=c.editImage?d(c.editImage):d('<img style="border: 1px solid transparent;">');var r=j.attr("src",g[0].value).attr("unselectable","on");if(g[1].value){r.attr("alt",g[1].value).attr("title",g[1].value);}if(g[2].value&&!isNaN(parseInt(g[2].value))){r.width(g[2].value);}else{r.css("width","auto");}if(g[3].value&&!isNaN(parseInt(g[3].value))){r.height(g[3].value);}else{r.css("height","auto");}if(g[4].value){if(g[4].value.toString()=="auto"){r.css("margin-left","auto");r.css("margin-right","auto");}else{if(g[4].value.toString().indexOf("%")!=-1){r.css("margin-left",parseInt(g[4].value)+"%");r.css("margin-right",parseInt(g[4].value)+"%");}else{r.css("margin-left",parseInt(g[4].value)+"px");r.css("margin-right",parseInt(g[4].value)+"px");}}}else{r.css("margin-left","0px");r.css("margin-right","0px");}if(g[5].value){if(g[5].value.toString()=="auto"){r.css("margin-top","auto");r.css("margin-bottom","auto");}else{if(g[5].value.toString().indexOf("%")!=-1){r.css("margin-top",parseInt(g[5].value)+"%");r.css("margin-bottom",parseInt(g[5].value)+"%");}else{r.css("margin-top",parseInt(g[5].value)+"px");r.css("margin-bottom",parseInt(g[5].value)+"px");}}}else{r.css("margin-top","0px");r.css("margin-bottom","0px");}var i=l.find(".jqx-editor-align").jqxDropDownList("selectedIndex");if(i==1){r.css("float","left");}else{if(i==2){r.css("float","right");}else{if(i==0){r.css("float","none");}}}r.css("resize",false);r[0].oncontrolselect=function(){return false;};r[0].selectstart=function(){return false;};if(!c.editImage){if(!c.focused){c.editor.focus();}if(c.range){c.selectRange(c.range);}c.execute("insertHTML",r[0].outerHTML+"<span id='INSERTION_MARKER'>&nbsp;</span>",m);c.editor.focus();var h=d(c.editorDocument).find("#INSERTION_MARKER");c.selection.selectNode(h[0],true);if(c.getRange().setStartAfter){c.getRange().setStartAfter(h[0]);}h.remove();c.selection.collapse(false);c._refreshTools();c._preventDefault(k);}c.editImage=null;c._preventDefault(k);});l.appendTo(document.body);c.updating=true;c.addHandler(l,"open",function(){c.updating=true;setTimeout(function(){c.range=c.getRange();d(o[0]).focus();},25);});l.jqxWindow({resizable:false,width:280,okButton:n,cancelButton:a,theme:c.theme,isModal:true,position:{center:c.widget}});c.addHandler(l,"close",function(){c.updating=false;});if(!c.focused){c.editor.focus();c.selectRange(c.range);}c._preventDefault(b);return false;},editmode:function(b){var c=this;if(!b&&!c.readOnly){c._removeHandlers();c.editor.attr("contentEditable",false);var h=document.createTextNode(c.editor.html());var a=d("<pre>");a.html(h).attr({id:"sourceText",contentEditable:true}).css("height","100%");c.editor.html(a);if(c.buttons.hasOwnProperty("html")){c.buttons.html.addClass("active");}a.focus();}else{if(b&&c.readOnly){var h=c.editor.find("#sourceText").text();c.editor.html(h);if(c.buttons.hasOwnProperty("html")){c.buttons.html.removeClass("active");}c.editor.attr("contentEditable",true);c._addHandlers();}}c.readOnly=!b;},setMode:function(n){var c=this;if(!c.range){c.editor.focus();c.range=c.getRange();}var l;var o=c.editor[0];if(n){c._documentMode="source";var a=new f();var b=a.HTMLtoXML(o.innerHTML);b=a.FormatHTML(b);l=document.createTextNode(b);o.innerHTML="";var p=document.createElement("pre");o.contentEditable=false;p.style.height="100%";p.style.margin="0px";p.style.outline="none";p.style.display="block";p.id="sourceText";p.contentEditable=true;p.appendChild(l);o.appendChild(p);this.readOnly=true;}else{this._documentMode="html";if(document.all){o.innerHTML=o.innerText;}else{if(o.textContent){o.innerHTML=o.textContent;}else{l=document.createRange();l.selectNodeContents(o.firstChild);o.innerHTML=l.toString();}}o.contentEditable=true;c.readOnly=false;c._refreshTools();c.editor.focus();c.selection.selectNode(c.editor[0]);c.editor.scrollTop(0);c.selection.collapse(true);}d.each(this.commands,function(){if(this.widget){if(this.command!="viewsource"){switch(this.type){case"list":this.widget.jqxDropDownList({disabled:n});break;case"colorPicker":this.widget.jqxDropDownButton({disabled:n});break;case"button":this.widget.jqxButton({disabled:n});break;case"toggleButton":this.widget.jqxToggleButton({toggled:false,disabled:n});break;}}}});c.editor.focus();if(d.jqx.browser.mozilla){var m=d("<a href='#'>anchor</a>");c.editor.prepend(m);m.focus();m.remove();c.selection.collapse(true);}if(c.commands.html.widget){c.commands.html.widget.jqxToggleButton({toggled:n=="source"||n==true});c.commands.html.toggled=n=="source"||n==true;}},execute:function(c,n,o){var m=this;if(!m.readOnly){var b=m.editorDocument;if(m._documentMode=="source"){return;}if(m.linkPopup){m.linkPopup.remove();}m.editor.focus();if(d.jqx.browser.mozilla){}if(d.jqx.mobile.isTouchDevice()){setTimeout(function(){},25);}var p=function(g){try{if(g.command&&g.command.toLowerCase()=="inserthtml"){var h=m.getRange();var j=g.value;if(j.toString().indexOf("<")==-1){j="<span>"+g.value+"</span>";}m.selection.insertContent(""+j+"<span id='INSERTION_MARKER'>&nbsp;</span>");m.selectRange(h);setTimeout(function(){var k=d(m.editorDocument).find("#INSERTION_MARKER");m.selection.selectNode(d(k).prev()[0],true);k.remove();m.selection.collapse(false);},10);}else{if(g.command){if(b.queryCommandEnabled(g.command)){b.execCommand(g.command,false,g.value);}else{return false;}}else{if(b.queryCommandEnabled(g)){b.execCommand(g,false,g);}else{return false;}}}}catch(i){}};if(c=="custom"){var l=n.action(n.widget,m.editor);if(l){p(l);}}else{try{if(o&&o.action){var l=o.action(o.widget,m.editor);p(l);}else{if(b.queryCommandEnabled(c)){b.execCommand(c,false,n);}else{if(c=="insertHTML"){m.selection.insertContent(n);}else{return false;}}}}catch(a){if(c=="insertHTML"){m.selection.insertContent(n);}else{return false;}}}if(d.jqx.mobile.isTouchDevice()){setTimeout(function(){if(m.iframe){m.iframe[0].contentWindow.focus();}},500);}m._raiseEvent("change",{command:c,args:n});m.changed=true;m.range=m.getRange();}},destroy:function(){var i=this;i._removeHandlers();var a=i.tools.split(" ");var m=i.tools.split(" | ");var n=function(g){d.each(g,function(k,j){var h=i.commands[this];if(!h){return true;}switch(h.type){case"list":h.widget.jqxDropDownList("destroy");break;case"colorPicker":h.colorPicker.remove();h.widget.jqxDropDownButton("destroy");break;case"toggleButton":h.widget.jqxToggleButton("destroy");break;case"custom":if(i.destroyTool){i.destroyTool(this);}break;case"button":default:h.widget.jqxToggleButton("destroy");if(h.command==="insertimage"){if(d("#imageWindow"+i.element.id).length>0){d("#imageWindow"+i.element.id).find(".jqx-editor-align").jqxDropDownList("destroy");d("#imageWindow"+i.element.id).find("button").jqxButton("destroy");}}else{if(h.command==="createlink"){if(d("#linkWindow"+i.element.id).length>0){d("#linkWindow"+i.element.id).find(".jqx-editor-align").jqxDropDownList("destroy");d("#linkWindow"+i.element.id).find("button").jqxButton("destroy");d("#linkWindow"+i.element.id).find(".jqx-editor-link-checkbox").jqxCheckBox("destroy");}}}break;}});};if(m.length==0){n(a);}else{for(var o=0;o<m.length;o++){var p=m[o];var a=p.split(" ");n(a);}}var c=d(".jqx-editor-link-window");var b=d(".jqx-editor-image-window");if(c&&c.length>0){c.jqxWindow("destroy");}if(b&&b.length>0){b.jqxWindow("destroy");}if(i.inline){i.toolbar.remove();}else{i.widget.remove();i.host.remove();}i.iframe.remove();i.iframe=null;i.selection=null;i.editorDocument=null;i.contentEditableElement=null;},val:function(a){if(a!=undefined&&typeof a!="object"){this.editor.html(a);}return this.editor.html();},_raiseEvent:function(a,i){if(i==undefined){i={owner:null};}if(this._documentMode=="source"){return true;}var c=a;args=i;args.owner=this;var b=new d.Event(c);b.owner=this;b.args=args;if(this._textArea){var j=d(this._textArea).trigger(b);}else{var j=this.host.trigger(b);}i=b.args;return j;}});var e=function(b){var a={initialize:function(c){this.document=c;},getSelection:function(){return(this.document.getSelection)?this.document.getSelection():this.document.selection;},getRange:function(){var h=this.getSelection();if(!h){return null;}try{return h.rangeCount>0?h.getRangeAt(0):(this.document.createRange?this.document.createRange():this.document.selection.createRange());}catch(c){return this.document.body.createTextRange();}},selectRange:function(h){if(h.select){h.select();}else{var c=this.getSelection();if(c.addRange){c.removeAllRanges();c.addRange(h);}}},selectNode:function(m,l){var n=this.getRange();var o=this.getSelection();if(n.moveToElementText){n.moveToElementText(m);n.select();}else{if(o.addRange){try{l?n.selectNodeContents(m):n.selectNode(m);o.removeAllRanges();o.addRange(n);}catch(p){var c=p;}}else{o.setBaseAndExtent(m,0,m,1);}}return m;},isCollapsed:function(){var c=this.getRange();if(c.item){return false;}return c.boundingWidth==0||this.getSelection().isCollapsed;},collapse:function(j){var c=this.getRange();var i=this.getSelection();if(c.select){c.collapse(j);c.select();}else{j?i.collapseToStart():i.collapseToEnd();}},getContent:function(){var c=this.getRange();var j=d("<div>")[0];if(this.isCollapsed()){return"";}if(c.cloneContents){j.appendChild(c.cloneContents());}else{if(c.item!=undefined||c.htmlText!=undefined){d(j).html(c.item?c.item(0).outerHTML:c.htmlText);}else{d(j).html(c.toString());}}var i=d(j).html();return i;},getText:function(){var c=this.getRange();var h=this.getSelection();return this.isCollapsed()?"":c.text||(h.toString?h.toString():"");},getNode:function(){var c=this.getRange();if(!d.jqx.browser.msie||d.jqx.browser.version>=9){var h=null;if(c){h=c.commonAncestorContainer;if(!c.collapsed){if(c.startContainer==c.endContainer){if(c.startOffset-c.endOffset<2){if(c.startContainer.hasChildNodes()){h=c.startContainer.childNodes[c.startOffset];}}}}while(typeof(h)!="element"){h=h.parentNode;}}return b.id(h);}return b.id(c.item?c.item(0):c.parentElement());},insertContent:function(k){var l=this.getRange();if(l.pasteHTML){l.pasteHTML(k);l.collapse(false);l.select();}else{if(l.insertNode){l.deleteContents();if(l.createContextualFragment){l.insertNode(l.createContextualFragment(k));}else{var c=this.document;var m=c.createDocumentFragment();var n=c.createElement("div");m.appendChild(n);n.outerHTML=k;l.insertNode(m);}}}}};a.initialize(b);return a;};var f=function(){var a=/^<([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,t=/^<\/([-A-Za-z0-9_]+)[^>]*>/,p=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;var q=u("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");var v=u("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul");var c=u("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");var s=u("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");var b=u("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var o=u("script,style");var r=this.HTMLParser=function(i,k){var z,y,h,n=[],m=i;n.last=function(){return this[this.length-1];};while(i){y=true;if(!n.last()||!o[n.last()]){if(i.indexOf("<!--")==0){z=i.indexOf("-->");if(z>=0){if(k.comment){k.comment(i.substring(4,z));}i=i.substring(z+3);y=false;}}else{if(i.indexOf("</")==0){h=i.match(t);if(h){i=i.substring(h[0].length);h[0].replace(t,g);y=false;}}else{if(i.indexOf("<")==0){h=i.match(a);if(h){i=i.substring(h[0].length);h[0].replace(a,j);y=false;}}}}if(y){z=i.indexOf("<");var l=z<0?i:i.substring(0,z);i=z<0?"":i.substring(z);if(k.chars){k.chars(l);}}}else{i=i.replace(new RegExp("(.*)</"+n.last()+"[^>]*>"),function(x,w){w=w.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1");if(k.chars){k.chars(w);}return"";});g("",n.last());}m=i;}g();function j(F,E,D,x){E=E.toLowerCase();if(v[E]){while(n.last()&&c[n.last()]){g("",n.last());}}if(s[E]&&n.last()==E){g("",E);}x=q[E]||!!x;if(!x){n.push(E);}if(k.start){var w=[];D.replace(p,function(B,C){var A=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:b[C]?C:"";w.push({name:C,value:A,escaped:A.replace(/(^|[^\\])"/g,'$1\\"')});});if(k.start){k.start(E,w,x);}}}function g(D,w){if(!w){var C=0;}else{for(var C=n.length-1;C>=0;C--){if(n[C].toLowerCase()==w.toLowerCase()){break;}}}if(C>=0){for(var x=n.length-1;x>=C;x--){if(k.end){k.end(n[x]);}}n.length=C;}}};this.HTMLtoXML=function(g){var h="";g=g.replace(/\r/ig,"");g=g.replace(/\n/ig,"");r(g,{start:function(l,j,k){h+="<"+l;for(var i=0;i<j.length;i++){h+=" "+j[i].name+'="'+j[i].escaped+'"';}h+=(k?"/":"")+">";},end:function(i){h+="</"+i+">\r\n";},chars:function(i){h+=i;},comment:function(i){h+="<!--"+i+"-->";}});return h;};this.FormatHTML=function(L,N){var j,M,Q,I,m,l;N=N||{};M=N.indent_size||4;Q=N.indent_char||" ";m=N.brace_style||"collapse";I=Infinity;l=N.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];function P(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(w,y){for(var x=0;x<y.length;x++){if(w===y[x]){return true;}}return false;}};this.get_content=function(){var z="",x=[],w=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return x.length?x.join(""):["","TK_EOF"];}z=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(z,this.Utils.whitespace)){if(x.length){w=true;}this.line_char_count--;continue;}else{if(w){if(this.line_char_count>=this.max_char){x.push("\n");for(var y=0;y<this.indent_level;y++){x.push(this.indent_string);}this.line_char_count=0;}else{x.push(" ");this.line_char_count++;}w=false;}}x.push(z);}return x.length?x.join(""):"";};this.get_contents_to=function(y){if(this.pos==this.input.length){return["","TK_EOF"];}var A="";var x="";var w=new RegExp("</"+y+"\\s*>","igm");w.lastIndex=this.pos;var z=w.exec(this.input);var B=z?z.index:this.input.length;if(this.pos<B){x=this.input.substring(this.pos,B);this.pos=B;}return x;};this.record_tag=function(w){if(this.tags[w+"count"]){this.tags[w+"count"]++;this.tags[w+this.tags[w+"count"]]=this.indent_level;}else{this.tags[w+"count"]=1;this.tags[w+this.tags[w+"count"]]=this.indent_level;}this.tags[w+this.tags[w+"count"]+"parent"]=this.tags.parent;this.tags.parent=w+this.tags[w+"count"];};this.retrieve_tag=function(x){if(this.tags[x+"count"]){var w=this.tags.parent;while(w){if(x+this.tags[x+"count"]===w){break;}w=this.tags[w+"parent"];}if(w){this.indent_level=this.tags[x+this.tags[x+"count"]];this.tags.parent=this.tags[w+"parent"];}delete this.tags[x+this.tags[x+"count"]+"parent"];delete this.tags[x+this.tags[x+"count"]];if(this.tags[x+"count"]==1){delete this.tags[x+"count"];}else{this.tags[x+"count"]--;}}};this.get_tag=function(){var B="",z=[],E=false,x,C;do{if(this.pos>=this.input.length){return z.length?z.join(""):["","TK_EOF"];}B=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(B,this.Utils.whitespace)){E=true;this.line_char_count--;continue;}if(B==="'"||B==='"'){if(!z[1]||z[1]!=="!"){B+=this.get_unformatted(B);E=true;}}if(B==="="){E=false;}if(z.length&&z[z.length-1]!=="="&&B!==">"&&E){if(this.line_char_count>=this.max_char){this.print_newline(false,z);this.line_char_count=0;}else{z.push(" ");this.line_char_count++;}E=false;}if(B==="<"){x=this.pos-1;}z.push(B);}while(B!==">");var w=z.join("");var D;if(w.indexOf(" ")!=-1){D=w.indexOf(" ");}else{D=w.indexOf(">");}var y=w.substring(1,D).toLowerCase();if(w.charAt(w.length-2)==="/"||this.Utils.in_array(y,this.Utils.single_token)){this.tag_type="SINGLE";}else{if(y==="script"){this.record_tag(y);this.tag_type="SCRIPT";}else{if(y==="style"){this.record_tag(y);this.tag_type="STYLE";}else{if(this.Utils.in_array(y,l)){var A=this.get_unformatted("</"+y+">",w);z.push(A);if(x>0&&this.Utils.in_array(this.input.charAt(x-1),this.Utils.whitespace)){z.splice(0,0,this.input.charAt(x-1));}C=this.pos-1;if(this.Utils.in_array(this.input.charAt(C+1),this.Utils.whitespace)){z.push(this.input.charAt(C+1));}this.tag_type="SINGLE";}else{if(y.charAt(0)==="!"){if(y.indexOf("[if")!=-1){if(w.indexOf("!IE")!=-1){var A=this.get_unformatted("-->",w);z.push(A);}this.tag_type="START";}else{if(y.indexOf("[endif")!=-1){this.tag_type="END";this.unindent();}else{if(y.indexOf("[cdata[")!=-1){var A=this.get_unformatted("]]>",w);z.push(A);this.tag_type="SINGLE";}else{var A=this.get_unformatted("-->",w);z.push(A);this.tag_type="SINGLE";}}}}else{if(y.charAt(0)==="/"){this.retrieve_tag(y.substring(1));this.tag_type="END";}else{this.record_tag(y);this.tag_type="START";}if(this.Utils.in_array(y,this.Utils.extra_liners)){this.print_newline(true,this.output);}}}}}}return z.join("");};this.get_unformatted=function(z,y){if(y&&y.indexOf(z)!=-1){return"";}var A="";var x="";var w=true;do{if(this.pos>=this.input.length){return x;}A=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(A,this.Utils.whitespace)){if(!w){this.line_char_count--;continue;}if(A==="\n"||A==="\r"){x+="\n";this.line_char_count=0;continue;}}x+=A;this.line_char_count++;w=true;}while(x.indexOf(z)==-1);return x;};this.get_token=function(){var y;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var x=this.last_token.substr(7);y=this.get_contents_to(x);if(typeof y!=="string"){return y;}return[y,"TK_"+x];}if(this.current_mode==="CONTENT"){y=this.get_content();if(typeof y!=="string"){return y;}else{return[y,"TK_CONTENT"];}}if(this.current_mode==="TAG"){y=this.get_tag();if(typeof y!=="string"){return y;}else{var w="TK_TAG_"+this.tag_type;return[y,w];}}};this.get_full_indent=function(w){w=this.indent_level+w||0;if(w<1){return"";}return Array(w+1).join(this.indent_string);};this.printer=function(x,y,A,B,w){this.input=x||"";this.output=[];this.indent_character=y;this.indent_string="";this.indent_size=A;this.brace_style=w;this.indent_level=0;this.max_char=B;this.line_char_count=0;for(var z=0;z<this.indent_size;z++){this.indent_string+=this.indent_character;}this.print_newline=function(C,E){this.line_char_count=0;if(!E||!E.length){return;}if(!C){while(this.Utils.in_array(E[E.length-1],this.Utils.whitespace)){E.pop();}}E.push("\n");for(var D=0;D<this.indent_level;D++){E.push(this.indent_string);}};this.print_token=function(C){this.output.push(C);};this.indent=function(){this.indent_level++;};this.unindent=function(){if(this.indent_level>0){this.indent_level--;}};};return this;}j=new P();j.printer(L,Q,M,I,m);while(true){var k=j.get_token();j.token_text=k[0];j.token_type=k[1];if(j.token_type==="TK_EOF"){break;}switch(j.token_type){case"TK_TAG_START":j.print_newline(false,j.output);j.print_token(j.token_text);j.indent();j.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":j.print_newline(false,j.output);j.print_token(j.token_text);j.current_mode="CONTENT";break;case"TK_TAG_END":if(j.last_token==="TK_CONTENT"&&j.last_text===""){var n=j.token_text.match(/\w+/)[0];var h=j.output[j.output.length-1].match(/<\s*(\w+)/);if(h===null||h[1]!==n){j.print_newline(true,j.output);}}j.print_token(j.token_text);j.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var S=j.token_text.match(/^\s*<([a-z]+)/i);if(!S||!j.Utils.in_array(S[1],l)){j.print_newline(false,j.output);}j.print_token(j.token_text);j.current_mode="CONTENT";break;case"TK_CONTENT":if(j.token_text!==""){j.print_token(j.token_text);}j.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(j.token_text!==""){j.output.push("\n");var i=j.token_text;if(N.indent_scripts=="keep"){var g=0;}else{if(N.indent_scripts=="separate"){var g=-j.indent_level;}else{var g=1;}}var R=j.get_full_indent(g);var K=i.match(/^\s*/)[0];var O=K.match(/[^\n\r]*$/)[0].split(j.indent_string).length-1;var J=j.get_full_indent(g-O);i=i.replace(/^\s*/,R).replace(/\r\n|\r|\n/g,"\n"+J).replace(/\s*$/,"");if(i){j.print_token(i);j.print_newline(true,j.output);}}j.current_mode="TAG";break;}j.last_token=j.token_type;j.last_text=j.token_text;}return j.output.join("");};function u(g){var h={},j=g.split(",");for(var i=0;i<j.length;i++){h[j[i]]=true;}return h;}};})(jqxBaseFramework);