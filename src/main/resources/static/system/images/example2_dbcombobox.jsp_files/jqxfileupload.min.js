(function(b){b.jqx.jqxWidget("jqxFileUpload","",{});b.extend(b.jqx._jqxFileUpload.prototype,{defineInstance:function(){var a={width:null,height:"auto",uploadUrl:"",fileInputName:"",autoUpload:false,multipleFilesUpload:true,accept:null,browseTemplate:"",uploadTemplate:"",cancelTemplate:"",localization:null,renderFiles:null,disabled:false,rtl:false,events:["select","remove","uploadStart","uploadEnd"]};b.extend(true,this,a);},createInstance:function(){var a=this;if(a.host.jqxButton===undefined){throw new Error("jqxFileUpload: Missing reference to jqxbuttons.js");}if(b.jqx.browser.msie){if(b.jqx.browser.version<10){a._ieOldWebkit=true;if(b.jqx.browser.version<8){a._ie7=true;}}}else{if(b.jqx.browser.webkit){a._ieOldWebkit=true;}}a._fluidWidth=typeof a.width==="string"&&a.width.charAt(a.width.length-1)==="%";a._fluidHeight=typeof a.height==="string"&&a.height.charAt(a.height.length-1)==="%";a._render(true);},_render:function(a){var d=this;d._setSize();d._addClasses();if(a===true){d._appendElements();}else{d._removeHandlers();}d._addHandlers();if(d._ie7){d._borderAndPadding("width",d.host);if(d.height!=="auto"){d._borderAndPadding("height",d.host);}}b.jqx.utilities.resize(d.host,null,true);b.jqx.utilities.resize(d.host,function(){if(d._fluidWidth){if(d._ie7){d.host.css("width",d.width);d._borderAndPadding("width",d.host);}for(var j=0;j<d._fileRows.length;j++){var l=d._fileRows[j];var c=l.fileRow;if(d._ie7){c.css("width","100%");d._borderAndPadding("width",c);}if(!d.renderFiles){d._setMaxWidth(l);}}if(d.rtl&&d._ieOldWebkit){for(var k=0;k<d._forms.length;k++){var i=d._browseButton.position();d._forms[k].form.css({left:i.left,top:i.top});}}}if(d._ie7&&d._fluidHeight){d.host.css("height",d.height);d._borderAndPadding("height",d.host);}});},render:function(){this._render(false);},refresh:function(a){if(a!==true){this._render(false);}},destroy:function(){var a=this;a.cancelAll();a._removeHandlers(true);a.host.remove();},browse:function(){if(b.jqx.browser.msie&&b.jqx.browser.version<10){return;}var a=this;if(a.multipleFilesUpload===true||(a.multipleFilesUpload===false&&a._fileRows.length===0)){a._forms[a._forms.length-1].fileInput.click();}},_uploadFile:function(a){var d=this;if(d._uploadQueue.length===0){d._uploadQueue.push(a);}if(!d.renderFiles){a.uploadFile.add(a.cancelFile).hide();a.loadingElement.show();}a.fileInput.attr("name",d.fileInputName);d._raiseEvent("2",{file:a.fileName});a.form[0].submit();d._fileObjectToRemove=a;},uploadFile:function(a){var d=this;d._uploadFile(d._fileRows[a]);},uploadAll:function(){var d=this;if(d._fileRows.length>0){for(var a=d._fileRows.length-1;a>=0;a--){d._uploadQueue.push(d._fileRows[a]);}d._uploadFile(d._fileRows[0]);}},cancelFile:function(a){var d=this;d._removeSingleFileRow(d._fileRows[a]);},cancelAll:function(){var d=this;if(d._fileRows.length>0){for(var a=0;a<d._fileRows.length;a++){d._removeFileRow(d._fileRows[a]);}setTimeout(function(){d._browseButton.css("margin-bottom",0);},400);d._fileRows.length=0;d._hideButtons(true);}},propertyChangedHandler:function(q,i,s,j){var t=q.element.id;if(i==="localization"){if(j.browseButton&&(!s||j.browseButton!==s.browseButton)){q._browseButton.text(j.browseButton);q._browseButton.jqxButton({width:"auto"});}if(j.uploadButton&&(!s||j.uploadButton!==s.uploadButton)){q._uploadButton.text(j.uploadButton);q._uploadButton.jqxButton({width:"auto"});}if(j.cancelButton&&(!s||j.cancelButton!==s.cancelButton)){q._cancelButton.text(j.cancelButton);q._cancelButton.jqxButton({width:"auto"});}if(!q.renderFiles){if(j.uploadFileTooltip&&(!s||j.uploadFileTooltip!==s.uploadFileTooltip)){b("#"+t+" .jqx-file-upload-file-upload").attr("title",j.uploadFileTooltip);}if(j.uploadFileTooltip&&(!s||j.cancelFileTooltip!==s.cancelFileTooltip)){b("#"+t+" .jqx-file-upload-file-cancel").attr("title",j.cancelFileTooltip);}}return;}if(j!==s){switch(i){case"width":q.host.css("width",j);if(q._ie7){q._borderAndPadding("width",q.host);for(var r=0;r<q._fileRows.length;r++){var a=q._fileRows[r].fileRow;a.css("width","100%");q._borderAndPadding("width",a);}}q._fluidWidth=typeof j==="string"&&j.charAt(j.length-1)==="%";return;case"height":q.host.css("height",j);if(q._ie7){q._borderAndPadding("height",q.host);}q._fluidHeight=typeof j==="string"&&j.charAt(j-1)==="%";return;case"uploadUrl":for(var o=0;o<q._forms.length;o++){q._forms[o].form.attr("action",j);}return;case"accept":for(var p=0;p<q._forms.length;p++){q._forms[p].fileInput.attr("accept",j);}return;case"theme":b.jqx.utilities.setTheme(s,j,q.host);q._browseButton.jqxButton({theme:j});q._uploadButton.jqxButton({theme:j});q._cancelButton.jqxButton({theme:j});return;case"browseTemplate":q._browseButton.jqxButton({template:j});return;case"uploadTemplate":q._uploadButton.jqxButton({template:j});return;case"cancelTemplate":q._cancelButton.jqxButton({template:j});return;case"disabled":q._browseButton.jqxButton({disabled:j});q._uploadButton.jqxButton({disabled:j});q._cancelButton.jqxButton({disabled:j});if(j===true){q.host.addClass(q.toThemeProperty("jqx-fill-state-disabled"));}else{q.host.removeClass(q.toThemeProperty("jqx-fill-state-disabled"));}return;case"rtl":var l=function(c){var f=c?"addClass":"removeClass";q._browseButton[f](q.toThemeProperty("jqx-file-upload-button-browse-rtl"));q._cancelButton[f](q.toThemeProperty("jqx-file-upload-button-cancel-rtl"));q._uploadButton[f](q.toThemeProperty("jqx-file-upload-button-upload-rtl"));if(b.jqx.browser.msie&&b.jqx.browser.version>8){q._uploadButton[f](q.toThemeProperty("jqx-file-upload-button-upload-rtl-ie"));}for(var e=0;e<q._fileRows.length;e++){var d=q._fileRows[e];d.fileNameContainer[f](q.toThemeProperty("jqx-file-upload-file-name-rtl"));d.cancelFile[f](q.toThemeProperty("jqx-file-upload-file-cancel-rtl"));d.uploadFile[f](q.toThemeProperty("jqx-file-upload-file-upload-rtl"));d.loadingElement[f](q.toThemeProperty("jqx-file-upload-loading-element-rtl"));}};l(j);return;}}},_raiseEvent:function(g,j){if(j===undefined){j={owner:null};}var i=this.events[g];j.owner=this;var h=new b.Event(i);h.owner=this;h.args=j;if(h.preventDefault){h.preventDefault();}var a=this.host.trigger(h);return a;},_setSize:function(){var a=this;a.host.css("width",a.width);a.host.css("height",a.height);},_borderAndPadding:function(e,f){var a;if(e==="width"){a=parseInt(f.css("border-left-width"),10)+parseInt(f.css("border-right-width"),10)+parseInt(f.css("padding-left"),10)+parseInt(f.css("padding-right"),10);}else{a=parseInt(f.css("border-top-width"),10)+parseInt(f.css("border-bottom-width"),10)+parseInt(f.css("padding-top"),10)+parseInt(f.css("padding-bottom"),10);}f.css(e,f[e]()-a);},_addClasses:function(){var a=this;a.host.addClass(a.toThemeProperty("jqx-widget jqx-widget-content jqx-rc-all jqx-file-upload"));if(a.disabled===true){a.host.addClass(a.toThemeProperty("jqx-fill-state-disabled"));}},_appendElements:function(){var l=this,p="Browse",a=90,k="Upload All",n=90,o="Cancel All",m=90;var j=l.element.id;if(l.localization){if(l.localization.browseButton){p=l.localization.browseButton;a="auto";}if(l.localization.uploadButton){k=l.localization.uploadButton;n="auto";}if(l.localization.cancelButton){o=l.localization.cancelButton;m="auto";}}l._browseButton=b('<button id="'+j+'BrowseButton" class="'+l.toThemeProperty("jqx-file-upload-button-browse")+'">'+p+"</button>");l.host.append(l._browseButton);l._browseButton.jqxButton({theme:l.theme,width:a,template:l.browseTemplate,disabled:l.disabled});l._browseButton.after('<div style="clear: both;"></div>');l._bottomButtonsContainer=b('<div class="'+l.toThemeProperty("jqx-file-upload-buttons-container")+'"></div>');l.host.append(l._bottomButtonsContainer);l._uploadButton=b('<button id="'+j+'UploadButton" class="'+l.toThemeProperty("jqx-file-upload-button-upload")+'">'+k+"</button>");l._bottomButtonsContainer.append(l._uploadButton);l._uploadButton.jqxButton({theme:l.theme,width:n,template:l.uploadTemplate,disabled:l.disabled});l._cancelButton=b('<button id="'+j+'CancelButton" class="'+l.toThemeProperty("jqx-file-upload-button-cancel")+'">'+o+"</button>");l._bottomButtonsContainer.append(l._cancelButton);l._cancelButton.jqxButton({theme:l.theme,width:m,template:l.cancelTemplate,disabled:l.disabled});l._bottomButtonsContainer.after('<div style="clear: both;"></div>');if(l.rtl){l._browseButton.addClass(l.toThemeProperty("jqx-file-upload-button-browse-rtl"));l._cancelButton.addClass(l.toThemeProperty("jqx-file-upload-button-cancel-rtl"));l._uploadButton.addClass(l.toThemeProperty("jqx-file-upload-button-upload-rtl"));if(b.jqx.browser.msie&&b.jqx.browser.version>8){l._uploadButton.addClass(l.toThemeProperty("jqx-file-upload-button-upload-rtl-ie"));}}l._uploadIframe=b('<iframe name="'+j+'Iframe" class="'+l.toThemeProperty("jqx-file-upload-iframe")+'" src=""></iframe>');l.host.append(l._uploadIframe);l._iframeInitialized=false;l._uploadQueue=[];l._forms=[];l._addFormAndFileInput();l._fileRows=[];},_addFormAndFileInput:function(){var m=this;var j=m.element.id;var n=b('<form class="'+m.toThemeProperty("jqx-file-upload-form")+'" action="'+m.uploadUrl+'" target="'+j+'Iframe" method="post" enctype="multipart/form-data"></form>');m.host.append(n);var o=b('<input type="file" class="'+m.toThemeProperty("jqx-file-upload-file-input")+'" />');if(m.accept){o.attr("accept",m.accept);}n.append(o);if(m._ieOldWebkit){var p=m._browseButton.position();var l=m._browseButton.outerWidth();var k=m._browseButton.outerHeight();var a=m.rtl&&m._ie7?12:0;n.css({left:p.left-a,top:p.top,width:l,height:k});n.addClass(m.toThemeProperty("jqx-file-upload-form-ie9"));o.addClass(m.toThemeProperty("jqx-file-upload-file-input-ie9"));m.addHandler(n,"mouseenter.jqxFileUpload"+j,function(){m._browseButton.addClass(m.toThemeProperty("jqx-fill-state-hover"));});m.addHandler(n,"mouseleave.jqxFileUpload"+j,function(){m._browseButton.removeClass(m.toThemeProperty("jqx-fill-state-hover"));});m.addHandler(n,"mousedown.jqxFileUpload"+j,function(){m._browseButton.addClass(m.toThemeProperty("jqx-fill-state-pressed"));});m.addHandler(b(document),"mouseup.jqxFileUpload"+j,function(){if(m._browseButton.hasClass("jqx-fill-state-pressed")){m._browseButton.removeClass(m.toThemeProperty("jqx-fill-state-pressed"));}});}m.addHandler(o,"change.jqxFileUpload"+j,function(){var c=this.value;if(!b.jqx.browser.mozilla){if(c.indexOf("fakepath")!==-1){c=c.slice(12);}else{c=c.slice(c.lastIndexOf("\\")+1);}}var d=m._addFileRow(c,n,o);if(m._fileRows.length===1){m._browseButton.css("margin-bottom","10px");m._hideButtons(false);}if(m._ieOldWebkit){m.removeHandler(n,"mouseenter.jqxFileUpload"+j);m.removeHandler(n,"mouseleave.jqxFileUpload"+j);m.removeHandler(n,"mousedown.jqxFileUpload"+j);}m._addFormAndFileInput();m.removeHandler(o,"change.jqxFileUpload"+j);if(m.autoUpload===true){m._uploadFile(d);}});m._forms.push({form:n,fileInput:o});},_addFileRow:function(u,x,v){var s=this,o,t,n,q,a,r="Cancel",p="Upload File";o=b('<div class="'+s.toThemeProperty("jqx-widget-content jqx-rc-all jqx-file-upload-file-row")+'"></div>');if(s._fileRows.length===0){s._browseButton.after(o);}else{s._fileRows[s._fileRows.length-1].fileRow.after(o);}if(!s.renderFiles){t=b('<div class="'+s.toThemeProperty("jqx-widget-header jqx-rc-all jqx-file-upload-file-name")+'">'+u+"</div>");o.append(t);if(s.localization){if(s.localization.cancelFileTooltip){r=s.localization.cancelFileTooltip;}if(s.localization.uploadFileTooltip){p=s.localization.uploadFileTooltip;}}q=b('<div class="'+s.toThemeProperty("jqx-widget-header jqx-rc-all jqx-file-upload-file-cancel")+'" title="'+r+'"><div class="'+s.toThemeProperty("jqx-icon-close jqx-file-upload-icon")+'"></div></div>');o.append(q);a=b('<div class="'+s.toThemeProperty("jqx-widget-header jqx-rc-all jqx-file-upload-file-upload")+'" title="'+p+'"><div class="'+s.toThemeProperty("jqx-icon-arrow-up jqx-file-upload-icon jqx-file-upload-icon-upload")+'"></div></div>');o.append(a);n=b('<div class="'+s.toThemeProperty("jqx-file-upload-loading-element")+'"></div>');o.append(n);if(s.rtl){t.addClass(s.toThemeProperty("jqx-file-upload-file-name-rtl"));q.addClass(s.toThemeProperty("jqx-file-upload-file-cancel-rtl"));a.addClass(s.toThemeProperty("jqx-file-upload-file-upload-rtl"));n.addClass(s.toThemeProperty("jqx-file-upload-loading-element-rtl"));}s._setMaxWidth({fileNameContainer:t,uploadFile:a,cancelFile:q});}else{o.html(s.renderFiles(u));}if(s._ie7){s._borderAndPadding("width",o);s._borderAndPadding("height",o);if(!s.renderFiles){s._borderAndPadding("height",t);s._borderAndPadding("height",a);s._borderAndPadding("height",q);}}var w={fileRow:o,fileNameContainer:t,fileName:u,uploadFile:a,cancelFile:q,loadingElement:n,form:x,fileInput:v,index:s._fileRows.length};s._addFileHandlers(w);s._fileRows.push(w);s._raiseEvent("0",{file:u});return w;},_setMaxWidth:function(j){var h=this;var g=j.cancelFile.outerWidth(true)+j.uploadFile.outerWidth(true);var a=h._ie7?6:0;var i=h.host.width()-parseInt(h.host.css("padding-left"),10)-parseInt(h.host.css("padding-right"),10)-g-a-7;j.fileNameContainer.css("max-width",i);},_addFileHandlers:function(a){var f=this;if(!f.renderFiles){var e=f.element.id;f.addHandler(a.uploadFile,"mouseenter.jqxFileUpload"+e,function(){if(f.disabled===false){a.uploadFile.addClass(f.toThemeProperty("jqx-fill-state-hover"));}});f.addHandler(a.uploadFile,"mouseleave.jqxFileUpload"+e,function(){if(f.disabled===false){a.uploadFile.removeClass(f.toThemeProperty("jqx-fill-state-hover"));}});f.addHandler(a.uploadFile,"click.jqxFileUpload"+e,function(){if(f.disabled===false){f._uploadFile(a);}});f.addHandler(a.cancelFile,"mouseenter.jqxFileUpload"+e,function(){if(f.disabled===false){a.cancelFile.addClass(f.toThemeProperty("jqx-fill-state-hover"));}});f.addHandler(a.cancelFile,"mouseleave.jqxFileUpload"+e,function(){if(f.disabled===false){a.cancelFile.removeClass(f.toThemeProperty("jqx-fill-state-hover"));}});f.addHandler(a.cancelFile,"click.jqxFileUpload"+e,function(){if(f.disabled===false){f._removeSingleFileRow(a);}});}},_removeSingleFileRow:function(f){var e=this;e._removeFileRow(f);e._fileRows.splice(f.index,1);if(e._fileRows.length===0){setTimeout(function(){e._browseButton.css("margin-bottom",0);},400);e._hideButtons(true);}else{for(var a=0;a<e._fileRows.length;a++){e._fileRows[a].index=a;}}},_removeFileRow:function(a){var f=this;var e=f.element.id;if(!f.renderFiles){f.removeHandler(a.uploadFile,"mouseenter.jqxFileUpload"+e);f.removeHandler(a.uploadFile,"mouseleave.jqxFileUpload"+e);f.removeHandler(a.uploadFile,"click.jqxFileUpload"+e);f.removeHandler(a.cancelFile,"mouseenter.jqxFileUpload"+e);f.removeHandler(a.cancelFile,"mouseleave.jqxFileUpload"+e);f.removeHandler(a.cancelFile,"click.jqxFileUpload"+e);}a.fileRow.fadeOut(function(){a.fileRow.remove();a.form.remove();});f._raiseEvent("1",{file:a.fileName});},_hideButtons:function(a){var d=this;if(a===true){d._bottomButtonsContainer.fadeOut();}else{d._bottomButtonsContainer.fadeIn();}},_addHandlers:function(){var a=this;var d=a.element.id;if(!a._ieOldWebkit){a.addHandler(a._browseButton,"click.jqxFileUpload"+d,function(){a.browse();});}a.addHandler(a._uploadButton,"click.jqxFileUpload"+d,function(){a.uploadAll();});a.addHandler(a._cancelButton,"click.jqxFileUpload"+d,function(){a.cancelAll();});a.addHandler(a._uploadIframe,"load.jqxFileUpload"+d,function(){if(b.jqx.browser.chrome||b.jqx.browser.webkit){a._iframeInitialized=true;}if(a._iframeInitialized===false){a._iframeInitialized=true;}else{var c=a._uploadIframe.contents().find("body").html();a._raiseEvent("3",{file:a._uploadQueue[a._uploadQueue.length-1].fileName,response:c});if(a._fileObjectToRemove){a._removeSingleFileRow(a._fileObjectToRemove);a._fileObjectToRemove=null;}a._uploadQueue.pop();if(a._uploadQueue.length>0){a._uploadFile(a._uploadQueue[a._uploadQueue.length-1]);}}});},_removeHandlers:function(a){var g=this;var f=g.element.id;g.removeHandler(g._browseButton,"click.jqxFileUpload"+f);g.removeHandler(g._uploadButton,"click.jqxFileUpload"+f);g.removeHandler(g._cancelButton,"click.jqxFileUpload"+f);g.removeHandler(g._uploadIframe,"load.jqxFileUpload"+f);if(a===true){var h=g._forms[g._forms.length-1];g.removeHandler(h.fileInput,"change.jqxFileUpload"+f);if(g._ieOldWebkit){g.removeHandler(h.form,"mouseenter.jqxFileUpload"+f);g.removeHandler(h.form,"mouseleave.jqxFileUpload"+f);g.removeHandler(h.form,"mousedown.jqxFileUpload"+f);g.removeHandler(b("body"),"mouseup.jqxFileUpload"+f);}}}});})(jqxBaseFramework);